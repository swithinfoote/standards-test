<p><img
src="RackMultipart20230926-1-dmx0qn_html_a13326ecb0dad4a8.png" /></p>
<div class="line-block"></div>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_8e80700dc921bdc9.jpg" /></p>
<p>| ### <strong>API Guidelines</strong></p>
<h3 id="part-c-api-development-2021"><strong>Part C – API Development
2021</strong></h3>
<h3 id="version-2.0"><strong>Version 2.0</strong></h3>
<h2 id="section"></h2>
<h3 id="approved-june-2021"><strong>Approved June 2021</strong></h3>
<table>
<tbody>
</tbody>
</table>
<p>Crown copyright ©. This copyright work is licensed under the Creative
Commons Attribution 4.0 International licence. In essence, you are free
to copy, distribute and adapt the work, as long as you attribute the
work to the New Zealand Government and abide by the other licence terms.
<a href="http://creativecommons.org/licenses/by/4.0/">View a copy of
this licence</a>at http://creativecommons.org/licenses/by/4.0/ <img
src="RackMultipart20230926-1-dmx0qn_html_436478b605835d72.png" /></p>
<p>Please note that neither the New Zealand Government emblem nor the
New Zealand Government logo may be used in any way which infringes any
provision of the Flags, Emblems, and Names Protection Act 1981 or would
infringe such provision if the relevant use occurred within New Zealand.
Attribution to the New Zealand Government should be in written form and
not by reproduction of any emblem or the New Zealand Government logo.
Please see<a
href="http://www.legislation.govt.nz/act/public/1981/0047/latest/whole.html#dlm52216">Flags,
Emblems, and Names Protection Act 1981</a>at
http://www.legislation.govt.nz/act/public/1981/0047/latest/whole.html#dlm52216</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_fd103b8a2c35e34b.png" /> <img
src="RackMultipart20230926-1-dmx0qn_html_13540668986ee471.png" /></p>
<p>Published by the Department of Internal Affairs <a
href="http://www.digital.govt.nz/">www.digital.govt.nz</a></p>
<p><strong>Contents</strong></p>
<p><a href="#_heading=h.meukdy"><strong>1 Introduction
7</strong></a></p>
<p><a href="#_heading=h.36ei31r"><strong>1.1 Scope 7</strong></a></p>
<p><a href="#_heading=h.45jfvxd"><strong>1.2 Target Audience
8</strong></a></p>
<p><a href="#_heading=h.2koq656"><strong>1.3 Definition of API
8</strong></a></p>
<p><a href="#_heading=h.zu0gcz"><strong>2 API Design and Development
8</strong></a></p>
<p><a href="#_heading=h.3jtnz0s"><strong>2.1 API Artefacts
8</strong></a></p>
<p><a href="#_heading=h.1yyy98l"><strong>2.2 API Design
8</strong></a></p>
<p><a href="#_heading=h.4iylrwe"><strong>2.2.1 When is an API
appropriate? 9</strong></a></p>
<p><a href="#_heading=h.2y3w247"><strong>2.2.2 Types of API
9</strong></a></p>
<p><a href="#_heading=h.rjefff"><strong>2.2.3 API Design Principles
12</strong></a></p>
<p><a href="#_heading=h.243i4a2"><strong>2.2.4 Designing an API
14</strong></a></p>
<p><a href="#_heading=h.j8sehv"><strong>2.2.5 Design Considerations
15</strong></a></p>
<p><a href="#_heading=h.338fx5o"><strong>2.2.6 Design Driven Development
15</strong></a></p>
<p><a href="#_heading=h.wnyagw"><strong>2.2.7 Granularity
16</strong></a></p>
<p><a href="#_heading=h.3gnlt4p"><strong>2.2.8 Interface Specification
17</strong></a></p>
<p><a href="#_heading=h.1vsw3ci"><strong>2.2.9 Orchestration
18</strong></a></p>
<p><a href="#_heading=h.4fsjm0b"><strong>2.2.10 Software Development
Kits (SDK) 18</strong></a></p>
<p><a href="#_heading=h.2uxtw84"><strong>2.3 Architectural and
Deployment Patterns 18</strong></a></p>
<p><a href="#_heading=h.3u2rp3q"><strong>2.4 HTTP Verbs
19</strong></a></p>
<p><a href="#_heading=h.odc9jc"><strong>2.5 URI Construction
19</strong></a></p>
<p><a href="#_heading=h.38czs75"><strong>2.5.1 API Offering
20</strong></a></p>
<p><a href="#_heading=h.1nia2ey"><strong>2.5.2 Version
20</strong></a></p>
<p><a href="#_heading=h.47hxl2r"><strong>2.5.3 Namespaces
20</strong></a></p>
<p><a href="#_heading=h.2mn7vak"><strong>2.5.4 Resources and
Sub-resources 21</strong></a></p>
<p><a href="#_heading=h.11si5id"><strong>2.5.5 Word Separation
21</strong></a></p>
<p><a href="#_heading=h.3ls5o66"><strong>2.5.6 Query Arguments
21</strong></a></p>
<p><a href="#_heading=h.20xfydz"><strong>2.6 HTTP Headers
23</strong></a></p>
<p><a href="#_heading=h.4kx3h1s"><strong>2.6.1 Request Headers
23</strong></a></p>
<p><a href="#_heading=h.1f7o1he"><strong>2.6.2 Response Headers
24</strong></a></p>
<p><a href="#_heading=h.thw4kt"><strong>2.6.3 Customer X-HTTP Headers
25</strong></a></p>
<p><a href="#_heading=h.3dhjn8m"><strong>2.7 Returned Content
25</strong></a></p>
<p><a href="#_heading=h.1smtxgf"><strong>2.7.1 Resource Scope
25</strong></a></p>
<p><a href="#_heading=h.4cmhg48"><strong>2.7.2 Formats
25</strong></a></p>
<p><a href="#_heading=h.2rrrqc1"><strong>2.7.3 Layout
28</strong></a></p>
<p><a href="#_heading=h.16x20ju"><strong>2.7.4 JSON Property Names
28</strong></a></p>
<p><a href="#_heading=h.3qwpj7n"><strong>2.7.5 Consistency
28</strong></a></p>
<p><a href="#_heading=h.261ztfg"><strong>2.7.6 Singletons
vs. Collections 29</strong></a></p>
<p><a href="#_heading=h.l7a3n9"><strong>2.7.7 HATEOAS
31</strong></a></p>
<p><a href="#_heading=h.356xmb2"><strong>2.8 Consideration of state
33</strong></a></p>
<p><a href="#_heading=h.1kc7wiv"><strong>2.9 Batch Handling &amp;
Transactions 33</strong></a></p>
<p><a href="#_heading=h.44bvf6o"><strong>2.10 API Version Control
35</strong></a></p>
<p><a href="#_heading=h.2jh5peh"><strong>2.10.1 API Version Control
Methods 35</strong></a></p>
<p><a href="#_heading=h.1xrdshw"><strong>2.10.2 When to Version
36</strong></a></p>
<p><a href="#_heading=h.1c1lvlb"><strong>2.10.3 Software Configuration
Management 37</strong></a></p>
<p><a href="#_heading=h.3w19e94"><strong>2.11 Search 37</strong></a></p>
<p><a href="#_heading=h.2b6jogx"><strong>2.12 Caching
40</strong></a></p>
<p><a href="#_heading=h.qbtyoq"><strong>2.12.1 Response Cache
40</strong></a></p>
<p><a href="#_heading=h.1pgrrkc"><strong>2.12.2 Object Cache
42</strong></a></p>
<p><a href="#_heading=h.2olpkfy"><strong>2.13 Error Handling
43</strong></a></p>
<p><a href="#_heading=h.13qzunr"><strong>1.1.1 HTTP Status Codes
43</strong></a></p>
<p><a href="#_heading=h.3nqndbk"><strong>2.13.1 API-Specific Error Code
45</strong></a></p>
<p><a href="#_heading=h.22vxnjd"><strong>2.13.2 Human-Readable Error
Message 45</strong></a></p>
<p><a href="#_heading=h.i17xr6"><strong>3 API Governance
46</strong></a></p>
<p><a href="#_heading=h.1h65qms"><strong>4 Glossary of terms
46</strong></a></p>
<p><a href="#_heading=h.2gb3jie"><strong>5 Glossary of acronyms
48</strong></a></p>
<p><a href="#_heading=h.3fg1ce0"><strong>6 Further Reading
50</strong></a></p>
<p><a href="#_heading=h.4ekz59m"><strong>7 Appendix A – HTTP Verbs
52</strong></a></p>
<p><a href="#_heading=h.2tq9fhf"><strong>7.1 GET 52</strong></a></p>
<p><a href="#_heading=h.18vjpp8"><strong>7.2 POST 53</strong></a></p>
<p><a href="#_heading=h.3sv78d1"><strong>7.3 PUT 55</strong></a></p>
<p><a href="#_heading=h.280hiku"><strong>7.4 DELETE 57</strong></a></p>
<p><a href="#_heading=h.n5rssn"><strong>7.5 OPTIONS 58</strong></a></p>
<p><a href="#_heading=h.375fbgg"><strong>7.6 Other 58</strong></a></p>
<p><a href="#_heading=h.46ad4c2"><strong>8 Appendix B – HTTP Headers
59</strong></a></p>
<p><a href="#_heading=h.2lfnejv"><strong>8.1 Request Headers
59</strong></a></p>
<p><a href="#_heading=h.10kxoro"><strong>8.1.1 Accept
59</strong></a></p>
<p><a href="#_heading=h.3kkl7fh"><strong>8.1.2 Content-Type
59</strong></a></p>
<p><a href="#_heading=h.1zpvhna"><strong>8.1.3 Authorization
60</strong></a></p>
<p><a href="#_heading=h.4jpj0b3"><strong>8.1.4 Accept-Encoding
61</strong></a></p>
<p><a href="#_heading=h.2yutaiw"><strong>8.1.5 API Key Header
61</strong></a></p>
<p><a href="#_heading=h.1e03kqp"><strong>8.1.6
If-Modified-Since/If-None-Match 61</strong></a></p>
<p><a href="#_heading=h.3xzr3ei"><strong>8.1.7 Request tracking headers
62</strong></a></p>
<p><a href="#_heading=h.2d51dmb"><strong>8.2 Response Headers
62</strong></a></p>
<p><a href="#_heading=h.sabnu4"><strong>8.2.1 Content-Type
63</strong></a></p>
<p><a href="#_heading=h.3c9z6hx"><strong>8.2.2 Location
63</strong></a></p>
<p><a href="#_heading=h.1rf9gpq"><strong>8.2.3 Content-Location
63</strong></a></p>
<p><a href="#_heading=h.4bewzdj"><strong>8.2.4 Cache-Control
63</strong></a></p>
<p><a href="#_heading=h.2qk79lc"><strong>8.2.5 Expires
64</strong></a></p>
<p><a href="#_heading=h.15phjt5"><strong>8.2.6 ETag (Entity Tag)
64</strong></a></p>
<p><a href="#_heading=h.3pp52gy"><strong>8.3 Custom X- HTTP Headers
65</strong></a></p>
<p><a href="#_heading=h.jzpmwk"><strong>9 Appendix C – Example Interface
Specification 66</strong></a></p>
<p><a href="#_heading=h.xevivl"><strong>10 Appendix D -
Synchronous/Asynchronous Example Specifications 88</strong></a></p>
<p><a href="#_heading=h.1wjtbr7"><strong>11 Appendix E - Standards for
Developing APIs 92</strong></a></p>
<p><strong>Figures</strong></p>
<p><a href="#_heading=h.2ce457m"><strong>Figure 48: Asynchronous Claims
API 11</strong></a></p>
<p><a href="#_heading=h.2jxsxqh"><strong>Figure 49: API Layering
13</strong></a></p>
<p><a href="#_heading=h.3abhhcj"><strong>Figure 50: Caching sequence
diagram 41</strong></a></p>
<p><a href="#_heading=h.49gfa85"><strong>Figure 51: Caching sequence
diagram 42</strong></a></p>
<p><a href="#_heading=h.33zd5kd"><strong>Figure 52: Example Agency API –
delete customer 66</strong></a></p>
<p><a href="#_heading=h.1j4nfs6"><strong>Figure 53: Example Agency API –
get customer details 67</strong></a></p>
<p><a href="#_heading=h.434ayfz"><strong>Figure 54: Example Agency API –
modify customer 68</strong></a></p>
<p><a href="#_heading=h.2i9l8ns"><strong>Figure 55: Example Agency API –
create customer 69</strong></a></p>
<p><strong>Tables</strong></p>
<p><a href="#_heading=h.1d96cc0"><strong>Table 19: Types of API
10</strong></a></p>
<p><a href="#_heading=h.1a346fx"><strong>Table 20: Architectural and
Deployment Patterns 19</strong></a></p>
<p><a href="#_heading=h.2981zbj"><strong>Table 22: HTTP Verbs
19</strong></a></p>
<p><a href="#_heading=h.302dr9l"><strong>Table 22: Request Headers
24</strong></a></p>
<p><a href="#_heading=h.2eclud0"><strong>Table 23: Response Headers
24</strong></a></p>
<p><a href="#_heading=h.25b2l0r"><strong>Table 24: HTTP Status Codes
45</strong></a></p>
<p><a href="#_heading=h.415t9al"><strong>Table 6: Glossary of terms
48</strong></a></p>
<p><a href="#_heading=h.vgdtq7"><strong>Table 7: Glossary of acronyms
50</strong></a></p>
<p><a href="#_heading=h.1ulbmlt"><strong>Table 11: Further Reading
51</strong></a></p>
<p><a href="#_heading=h.4gjguf0"><strong>Table 25: Standards for
Developing APIs 92</strong></a></p>
<ol type="1">
<li><h1 id="introduction">Introduction</h1></li>
</ol>
<p>The Strategy for a Digital Public Service is “a call to action for
the public service to operate in the digital world in a more modern and
efficient way — delivering the outcomes that Aotearoa New Zealand
needs.”</p>
<p>It envisions a future where agencies prioritise the creation of open
Application Programming Interfaces (APIs) to enable reuse of data,
transactions and rules, which, in turn, creates an opportunity for
greater cooperation and interoperability between agencies to
dramatically improve service design and delivery.</p>
<p>Agencies need focused guidance, approaches and techniques to help
increase their knowledge and skills around APIs. There is a wide range
in the level of knowledge and skill regarding API design and delivery
across government agencies. Hence this document tries to offer a balance
of guidance for those new to APIs along with quick lookup standards,
which should assist agencies in achieving consistency and commonality in
their API deliverables.</p>
<ol type="1">
<li><strong>Scope</strong></li>
</ol>
<p>This document set aims to provide a set of high-level standards with
design and implementation guidance, along with low-level API best
practices to guide government agencies in their development of APIs.</p>
<ul>
<li><strong>Part A – API Concepts and Management 2021</strong> Looks at
the business context for APIs within government and articulates the
principles and considerations that could impact an agency when creating
APIs. It looks at APIs in the context of their impact on the
organisation as well as across government and public services through to
commercial innovation. Version 1.0 published in 2016 was called API
Standard and Guidelines - Part A – Business.</li>
<li><strong>Part B – API Security 2021</strong> Part B contains the API
Security reference architecture and technical details for implementing
API Security. Version 1.0 published in 2016 was called API Standard and
Guidelines - Part A – Technical but has been split into a Part B -
Security and Part C – Development for this version 2.0.</li>
<li><strong>Part C – Development</strong> Part C (This document)
contains the technical details for API Development, including general
API implementation standards for API developers &amp; consuming
application developers. Version 1.0 published in 2016 was called API
Standard and Guidelines - Part A – Technical but has been split into a
Part B - Security and Part C – Development for this version 2.0.</li>
</ul>
<p>The guidance in this document set is intended to apply for all API
standards and protocols, however much of the guidance is oriented to
REST APIs.</p>
<p>Applicable technical standards are referenced throughout the document
set and are intended to provide detailed guidance for developers of API
standards.</p>
<p>Examples presented in this document are purely illustrative examples
and do not represent recommended API design and/or data content
requirements for NZ Government.</p>
<p>The document will use hypothetical or actual use cases with a
government context to illustrate practical application of the concepts
described.</p>
<ol type="1">
<li><strong>Target Audience</strong></li>
</ol>
<p>The target audience for this document – Part C Development - is
primarily solution designers and API developers within, or contracted
to, agencies and organisations within the public service.</p>
<p>Additionally, compliance and assurance personnel may be interested,
as well, in terms of assessing alignment with the standards and
guidelines.</p>
<ol type="1">
<li><strong>Definition of API</strong></li>
</ol>
<p>APIs and associated examples in this document are primarily _
<strong>Web APIs</strong> _ or APIs that are accessible via the http(s)
protocol. There are some notable exceptions such as asynchronous APIs.
An API however should not be confused with a service. It is true that
web services are, by definition, APIs however not all APIs are web
services. An API is an interface that enables one application to
communicate with another application, but the communication protocol is
agnostic.</p>
<p>It is important to stress that for the purposes of this document we
are discussing web APIs that enable interoperability and not software
engineering principles.</p>
<ol type="1">
<li><h1 id="api-design-and-development">API Design and
Development</h1></li>
</ol>
<p>This section looks at APIs from a development perspective and offers
the guidelines and standards required to support government agencies in
designing, developing and governing APIs. The intended audience for this
section of the document are _ <strong>technical</strong> _ for example
developers, architects or API designers.</p>
<p>When reading this document consider the implications on you as an
agency. Fundamentally, APIs should make interoperability with your
agency a simple, but more importantly a consistent process.</p>
<p>This section will cover areas of key consideration such as good API
design, correct use of the http protocol, version control and various
technical standards.</p>
<ol type="1">
<li><h2 id="api-artefacts">API Artefacts</h2></li>
</ol>
<p>There are some fundamental artefacts which comprise an API
deliverable:</p>
<ul>
<li>Interface specification, accessible via some form of catalogue</li>
<li>API code and policies</li>
<li>Tests</li>
<li>Service Level Agreement (SLA) for the API, identifying performance,
availability etc.</li>
</ul>
<p>These artefacts are the responsibility of the API developer and
should be mandated as a minimum set of deliverables when developing an
API. All of these artefacts must be managed in a source code management
system (SCM) so that changes can be tracked and collaborative
development can be performed.</p>
<ol type="1">
<li><h2 id="api-design">API Design</h2></li>
</ol>
<p>Application developers will invest heavily in using your API. They
will invest in learning the design and behaviour of your API, in
developing and testing around your API and may even invest in developing
an entire business model on your API.</p>
<p>Good API designs will attract more developers. Conversely, bad API
designs will drive away developers and drive up costs – support costs,
maintenance costs and operating costs.</p>
<pre><code>1.</code></pre>
<h3 id="when-is-an-api-appropriate">When is an API appropriate?</h3>
<p>In the past, the default reaction to a requirement for capability has
been to develop a web application. This is now gravitating towards APIs
as the default. So, when is it better to build an API than a web
application? Below are some situations where an API may be more
appropriate:</p>
<ul>
<li><p>When commercial organisations or NGOs are screen scraping data
from the agency’s website</p></li>
<li><p>When the agency holds a single authoritative source of the
truth</p></li>
<li><p>Where there is a need for (near real time) information exchange
with a partner agency</p></li>
<li><p>When parts of a business process are (or may be)
outsourced</p></li>
<li><p>When the agency’s service can be included as part of a larger
business process</p></li>
<li><p>When an agency needs internal systems to interact with
cloud-based COTS solutions (SaaS)</p></li>
<li><p>Where businesses require easy access to (public)
information</p></li>
<li><p>Where commercial organisations want to build capability into
their own applications which will benefit the public (mobile/web
apps)</p></li>
<li><p>When an agency expects other parties to act as agents or
intermediaries for their services</p></li>
<li><p>When an agency expects to support service delivery across
multiple channels</p>
<ol type="1">
<li><h3 id="types-of-api">Types of API</h3></li>
</ol></li>
</ul>
<p>There are several different types of API and the type you choose may
depend on the technical use cases that you apply to both consumption and
provision of your API.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>API Type</th>
<th>Description</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>REST</td>
<td>Representational State Transfer (REST) is the most common and well
understood API type. REST should be considered an architectural style
for developing distributed hypermedia systems. There is a wealth of
information and tooling to support the definition and creation of REST
APIs. Typically, a REST API will have a well-defined and strongly typed
schema definition (OpenAPI) where strict compliance can be
achieved.</td>
<td>Creating distributed system where a set of API resources are well
defined. If medium latency resource creation or modification (POST, PUT,
DELETE) is required then typically a REST API is a better fit. Typically
used for synchronous interactions.</td>
</tr>
<tr class="even">
<td>GraphQL</td>
<td>GraphQL is an open source query and manipulation language developed
by Facebook primarily designed to empower API consumers to consume only
the data that they require. A common criticism of REST is that only the
entire resource is available for consumption, sometimes referred to as
“over fetching”, however with GraphQL the client decides the data that
it requires. GraphQL also has a strongly typed schema (GraphQL Schema
Definition Language – SDL).</td>
<td>An API that has a widely distributed client set with a variety of
data requirements. Particularly well suited to high read (GET)
clients</td>
</tr>
<tr class="odd">
<td>Asynchronous APIs</td>
<td>AsyncAPI is an open source initiative to create an event-driven and
asynchronous API standardization and development tooling. The AsyncAPI
specification, inspired by the OpenAPI specification, describes and
documents event-driven APIs in a machine-readable format.</td>
<td></td>
</tr>
<tr class="even">
<td>Creating distributed systems where a set of API resources are well
defined. Typically used for asynchronous interactions and event driven
architectures. Also, useful when developing APIs that front workflows or
long running orchestrations.</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>gRPC</td>
<td>gRPC is a modern open source high performance Remote Procedure Call
(RPC) framework that can run in any environment. In gRPC, a client
application can directly call a method on a server application on a
different machine as if it were a local object, making it easier for you
to create distributed applications and services. This is enabled by a
formal Interface Definition Language (IDL). gRPC utilizes Protocol
Buffers by default, you can make it work with other data formats, such
as JSON.</td>
<td>Creating distributed systems that require highly performant and
scalable API’s. gRPC makes use of binary data rather than just text
which makes the communication more compact and more efficient.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><em>Table 19: Types of API</em></p>
<p>Example Technical Use Case Synchronous/Asynchronous API</p>
<p>The illustrative example below demonstrates a combination of a
synchronous API and an asynchronous API.</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_5fc2b97799454495.png" /></p>
<p><em>Figure 48: Asynchronous Claims API</em></p>
<p>The example above has 2 associated API specifications. The first is
an OpenAPI specification that describes the “Create Claim” and “Get
Claim” RESTful interactions and the second is an AsyncAPI specification
that describes the “Receive Updates” interaction. These example
specifications have been provided in the appendix of this document for
reference – see <a href="#_heading=h.2vor4mt">Synchronous/Asynchronous
Example Specifications</a></p>
<pre><code>1.</code></pre>
<h3 id="api-design-principles">API Design Principles</h3>
<p>This section assumes that API Principles defined in section 4 of Part
A of this standard have already been read.</p>
<pre><code>  1.</code></pre>
<h4 id="future-focused-design">Future-Focused Design</h4>
<p>APIs should not be tightly coupled to legacy applications, exposing
whatever capabilities the legacy system offered. Nor should they be
designed to work in the way the legacy system currently works.</p>
<p>Instead they should be consumer driven – so built to expose the
resources that consumers need, whether those resources are in legacy
systems or new. There should not be a drive to expose an entire product
via the API, or wait for the perfect backend system to be available.
Just offer as much as is practically useful, then evolve it to meet
needs. Design the API interface to be abstracted from the backend, so
that backend systems can be changed or replaced over time without
needing to change the interface.</p>
<p>The aim is to be future-focused (whilst still pragmatic) and develop
APIs to meet future needs. A good example of being future focussed is
building APIs to support HATEOAS (Hypermedia as the Engine of
Application State). This is where an API, in response to a consuming
application’s request, is programmed to return hyperlinks (URLs) which
indicate the options for subsequent actions or information. See <a
href="#_heading=h.l7a3n9">section 2.7.7</a> for more details on
HATEOAS.</p>
<pre><code>  1.</code></pre>
<h4 id="layering">Layering</h4>
<p>When designing and developing an API it is important to consider that
an API is made up of distinct functional layers:</p>
<ul>
<li><p>Security</p></li>
<li><p>Caching</p></li>
<li><p>Representation</p>
<pre><code>  1.</code></pre>
<h5 id="security">Security</h5></li>
</ul>
<p>Every API will have a security component. It is important to
recognise that this is not only authentication and authorisation for
access to an API, it also includes threat protection (DDoS, SQL
Injection, Cross site scripting etc.) as well as availability and
quality of service (QoS). When designing and developing APIs it is often
cost effective to create a common framework that handles security for
all APIs. See the associated document, Part B, API Security, for more
details.</p>
<pre><code>    1.</code></pre>
<h5 id="caching">Caching</h5>
<p>Caching can dramatically improve the performance of an API. When
designing APIs consider what, when and where to cache. Understanding how
data is changed and how often it is changed is an important
consideration, as well as which layer it is most appropriate to cache
at. A common caching strategy should be developed for APIs that would
benefit from it. See <a href="#_heading=h.2pta16n">section 2.12</a> for
more details.</p>
<pre><code>    1.</code></pre>
<h5 id="representation">Representation</h5>
<p>When designing and developing an API it is important to consider the
representation of that API. This commonly includes an interface
specification that fully describes the API. To ensure the success of an
API it should be easy to consume driving a well-considered
representation layer.</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_73f2c8bf36bc8fce.png" /></p>
<p><em>Figure 49: API Layering</em></p>
<pre><code>  1.</code></pre>
<h4 id="standards-based">Standards-Based</h4>
<p>Web standards have rapidly become powerful agreements, which span not
just local regions but are internationally accepted and enable
commonality and consistency. Using standard HTTP and URLs, the core
technologies of the web, along with standards such as JSON and OAuth
ensures that agencies are not creating bespoke or proprietary
technologies.</p>
<p>Hence the principle is to build to the latest versions of existing
open and accepted standards e.g.</p>
<ul>
<li>HTTP</li>
<li>OpenAPI</li>
<li>AsyncAPI</li>
<li>REST</li>
<li>JSON</li>
<li>OAuth</li>
<li>OIDC</li>
</ul>
<p>Refer to the <a href="#_heading=h.3hej1je">appendix</a> for detailed
information about relevant standards.</p>
<pre><code>1.</code></pre>
<h3 id="designing-an-api">Designing an API</h3>
<p>When designing an API, it is important to perform business process
analysis to ensure that API development is business-driven rather than
technology-driven. Technology driven projects rarely meet customers’
needs in the long run, so it important to gain background in who could
be using the API, for what. As mentioned previously, co-design is
fundamental to driving the right API development. To help identify
potential partners to involve in the co-design, consider:</p>
<ul>
<li>processes which currently depend on information the API could
expose</li>
<li>processes which require a capability an API could expose</li>
</ul>
<p>Some actors will be human (e.g. application developers) whilst some
actors will be the systems which will interact with, or depend on, the
API. There may be different types of actors, some public sector, some
commercial entities, some public.</p>
<p>When representatives for the potential actors are identified, start
co-designing with these representatives. First and foremost, consider
the requirements for the API. Application developers often couch their
requirements in terms of how the API should work, rather than what the
API needs to do. Don’t get bogged down in the variety of proposed
solutions from each developer: focus on extracting their true
requirements by performing functional analysis (e.g. use cases) and data
flow analysis. Then identify resources and work out the granularity
needed (see sections <a href="#_heading=h.243i4a2">2.2.4 Designing an
API</a> &amp; <a href="#_heading=h.wnyagw">2.2.7 Granularity</a>).</p>
<p>It is especially important that security and information privacy
impacts are identified up front and addressed early on in the design
process. Assess the information being passed and the types of access
different customers and/or consuming applications should have to the
API. This will help drive development of security policies alongside the
design of the API.</p>
<p>One common pitfall in API design is to map all existing data tables
onto resources and develop the associated CRUD capabilities into an API.
Usually this results in a poor API design and tightly couples the API
design to the underlying data structure. Another common pitfall is to
design APIs as an extension to, or way into, monolithic legacy systems.
This should be avoided as it tightly couples the API to the legacy
system. Both of these pitfalls will create issues for both provider and
consumers in the long term.</p>
<p>At this point in the design process, agility is probably more
important than completeness. Share early design thoughts and interface
specifications with the developer community and quickly make changes in
response to their feedback. Work through some sequence diagrams with
them to help pin down API interactions and inform API design
thinking.</p>
<p>The correct API design will likely not please every developer, so
don’t try to be all things to all developers. A rule of thumb is that
you are probably on the right track if most developers are a
<em>little</em> unhappy, but all are able to achieve their aims with the
proposed design.</p>
<p>It is important not to try to bypass evolution steps and try to build
for all potential use cases right from the offset. For a more measured
progression towards API delivery, start simple and focus on a single
channel or interaction initially. By building onto these simple building
blocks, API evolution over time naturally progress towards omnichannel
applications.</p>
<pre><code>1.</code></pre>
<h3 id="design-considerations">Design Considerations</h3>
<p>The following considerations emerge when looking to develop APIs in
the public sector:</p>
<ul>
<li><p>Understand your data, understand your consumers. Before starting
work on APIs, gain a good understanding of what data you hold, the
complexity of that data, its relationships to other data, the downstream
dependents on that data and potential consumers of the data. It is also
a good idea to understand your consumers’ drivers and downstream usage
or customers.</p></li>
<li><p>Design for REST. If the interaction appears RESTful then develop
a REST API, e.g. one-to-many. In some cases however, a gRPC or GraphQL
API may be appropriate and are supported by this document. REST APIs are
widely understood, easier to govern and suitable for most
interoperability use cases. It is also important to note here that if
there is an appropriate supported standard such as Fast Health
Interoperability Resource (FHIR) then the resources defined in that
standard should be used rather than a set of agency defined
resources.</p></li>
<li><p>The information supplied via an API may still be dependent on
overnight batch processes for update. It is worth making the
information’s timeliness and update period clear to potential consumers
of the API.</p></li>
<li><p>APIs should not be used to handle large batch transfers because
of the atomic nature of the usage i.e. if one single data write fails
then the whole batch fails. APIs work better for multiple individual
update transactions.</p>
<ol type="1">
<li><h3 id="design-driven-development">Design Driven
Development</h3></li>
</ol></li>
</ul>
<p><strong>Required</strong></p>
<p>When building APIs, a Design Driven Approach must be taken.</p>
<p>This includes:</p>
<ul>
<li><p>Interface specification first</p></li>
<li><p>Iterative approach</p></li>
<li><p>Continuous integration/testing</p>
<pre><code>1.</code></pre>
<h4 id="interface-specification-first">Interface Specification
First</h4></li>
</ul>
<p>The best way to design an API is in collaboration with potential
consumers of that API. Creating the interface specification first makes
it easier for application developers to see what the API is going to
offer and how it could be used. Their early feedback will ensure that
the API design is heading on the right track and will be usable and
appropriate to their needs. Using a simple modelling language to define
the interface specification makes it easy to view and edit API
definitions. See <a href="#_heading=h.3gnlt4p">section 2.2.8</a> for
more information about defining interface specifications.</p>
<pre><code>  1.</code></pre>
<h4 id="iterative-approach">Iterative Approach</h4>
<p>It has been acknowledged that big bang releases rarely deliver
business or customer benefit. An iterative approach, with ongoing
releases offering gradual improvement or evolving capability, gives a
finer tuned delivery, better sense of momentum, illustrates progress and
enables third parties to coordinate efforts with API developments.
ICT.govt.nz Accelerate (<a
href="https://www.ict.govt.nz/guidance-and-resources/accelerate/">https://www.ict.govt.nz/guidance-and-resources/accelerate/</a>)
offers a framework which supports this kind of development and has
guidance on how to deliver transformational projects.</p>
<p>An iterative approach incorporates continuous improvement, which
recognises the need to support continuing evolvement of the API beyond
the first delivery. The API is a product whose capabilities should
undergo continuing improvements based on consumer feedback, performance
analytics and emerging needs. This aligns to Phase 6 in the Accelerate
framework.</p>
<pre><code>  1.</code></pre>
<h4 id="automation-first">Automation First</h4>
<p>Automation provides a quick turnaround for informing API developers
about breaking changes being submitted by developers who are all working
on the same code base or product (e.g. API). The idea is that all
developers submit code changes as often as possible (e.g. into a version
control system), allowing code to go through an automated, integrated
build process which ensures that nothing has broken the build. This
build process could happen many times a day. Any errors are quickly
identified and alerted to the team who can rectify them in a timely
fashion.</p>
<p>Tests can be written against the interface specification quite early
on in the development process by developing just enough API code to
enable the test to be run (stubs). The tests can then be incorporated
into the automated build process, giving early warning of regression
test failures. API code should not be able to progress through SDLC
environments until successful test execution.</p>
<pre><code>1.</code></pre>
<h3 id="granularity">Granularity</h3>
<p>There is a question as to how fine-grained an API resource should be.
APIs should be designed at the lowest practical level of granularity
because this makes each service simpler and allows them to be combined
in ways that suit the application developer. The key principle is to
design services that can be re-used and combined in different ways, and
not tie the application developer to a specific way of working or
sequence of API consumption just because that is how it is configured or
built in the back end.</p>
<p>If an API offers very fine-grained resources, then consuming
applications end up having to make many more calls to the API in order
to collect all the information they need, resulting in chattier
communications. On the other hand, if the API is based on very coarse
grained resources (returning everything about the resource) the response
payloads could end up being enormous, may not support all API
application developers’ needs, and the API could become cumbersome to
use and maintain.</p>
<p>There may also be a need for varying granularity within one API,
depending on the purpose and use of that API. For example, if a blogging
API was being created, it may make sense to offer a coarse grained
resource for posting a new blog entry as a bundle of content including
pictures, sound, keywords as well as the textual blog entry. But when
offering the ability to like or comment on a blog entry it would make
sense, for clarity and ease of use, to offer these as separate
sub-resources, one for indicating a ‘like’ and one for submitting a
comment.</p>
<p>It is important to aim for a granularity which will prevent business
logic from leaking into the API e.g. requiring API calls to be made in a
certain sequence to meet with internal business processes. With the
blogging example, consider the impact of a fine-grained API being
offered for posting blog entries, with separate calls for adding images,
sounds and metadata. If metadata is mandatory, then the API application
developer needs to ensure that every blog post call is followed by a
metadata call. This puts the onus on the application developer to get
the sequence of calls correct and could lead to inconsistent data if
they do not adhere to the rules. It also leads to close coupling between
the consuming application and the API, and if the business logic changes
in the future there is a downstream impact on all application
developers, requiring them to modify their applications.</p>
<p>General guidelines are:</p>
<ul>
<li><p>Don’t aim for the finest granularity - an API should be built
around each discrete and updateable resource</p></li>
<li><p>There does not need to be a one-to-one mapping between a manual
service and a corresponding API; APIs should support the process but not
try to encapsulate the process</p></li>
<li><p>A rough guide is to have one API operation for each entity
lifecycle state transition</p></li>
<li><p>Resources can be identified by reviewing a business process and
identifying the key entities which underpin the process. Any entities
which the organisation manages or maintains throughout its full
lifecycle will be potential API resources. There is typically one API
operation for each entity lifecycle state transition.</p></li>
<li><p>There should be only one API function for one business outcome
(e.g. change an address)</p></li>
<li><p>Consider using query parameters in URLs for different granularity
of resources. For example, /passengers.json could return a list of
names, whilst /passengers.json?detail=full could return detailed
information about each passenger in a list.</p>
<ol type="1">
<li><h3 id="interface-specification">Interface Specification</h3></li>
</ol></li>
</ul>
<p>An API represents a contract between the provider and the consumer
for access to provider resources. Because API consumption is a
programmatic exercise, it is important to have a clear definition of
what the API offers and how those API resources are to be accessed. This
definition is the interface specification.</p>
<p>The interface specification should be designed in advance of
developing the API, as the act of working out the specification often
helps think through all the issues that could impact the design of the
underlying resource-handling code. It also helps consuming application
developers to review the capabilities being offered to see if the
capabilities meet their needs before they start developing to the
specification. When outsourcing API development, the interface
specification can be written in abstract as a means of defining the API
the vendor should build. The specification can be handled as a separate
entity, is version controllable, and it should be possible to use it as
the main API documentation or reference.</p>
<p>There are several API modelling languages available for defining the
interface specification. Some are proprietary (e.g. RAML, API Blueprint)
whilst others are machine-readable but not human readable (e.g. WADL).
The most commonly used API modelling language today is an open standard
known as the OpenAPI Specification (formerly Swagger) maintained by the
Open API Initiative. This initiative is supported by many of the main
commercial entities in IT (Google, IBM, Microsoft, Atlassian, Paypal
etc.). It offers a standard, programming language-agnostic (JSON/YAML)
interface to REST APIs which allows both humans and computers to
discover and understand the capabilities of the service. For an example
of a Swagger interface specification see Appendix C - Example Interface
Specification.</p>
<p>It is important to use a modelling language to define the API
interface specification as essentially it is text or code and can be
maintained using source code management systems.</p>
<p><strong>Recommended</strong></p>
<p>Use <a href="https://openapis.org/">OpenAPI/Swagger</a> as the
interface specification language for all APIs being developed.</p>
<pre><code>1.</code></pre>
<h3 id="orchestration">Orchestration</h3>
<p>As a general rule using APIs as an orchestration tool is not
recommended. This is due to the complexity that this can introduce to an
API architecture. That said, however, simple orchestration may in some
cases be appropriate. An example of this may be a mashup API that
creates a new logical API resource by combining related data held in two
or more back end systems.</p>
<p>A mashup is not appropriate when you create an API that merges two
distinct API products together. If a consumer requires this
functionality the mashup should be performed by the consuming
application.</p>
<p>Other examples of simple orchestration could include mediation such
as message transformation (JSON to XML or canonical message model
transformation).</p>
<pre><code>1.</code></pre>
<h3 id="software-development-kits-sdk">Software Development Kits
(SDK)</h3>
<p><strong>Recommended</strong></p>
<p>It is recommended that API Providers offer an SDK to developers of
consuming applications.</p>
<p>An SDK can be considered the implementation toolset for use of an
agency’s APIs. By providing developers with an SDK they can build
applications faster without having to understand all of the API’s
complexities. An SDK should provide sample code that explains the
functionality of your API to potential application developers.</p>
<p>An example of a public service API SDK can be found at the <a
href="http://usdepartmentoflabor.github.io/Ruby-Sample-App/">US
Department of Labour GitHub repository</a>Publication/Catalogue</p>
<p>Once an API is in sufficient state to be offered to API consumers,
the API definition should be published to an API catalogue. The primary
API discoverer is the developer, so an external API must be well
documented, and provide accurate and up-to-date guidance via the
catalogue.</p>
<p>Government are considering options for a central point of discovery
for externally accessible public sector APIs.</p>
<p><strong>Recommended</strong></p>
<p>Publishing to a catalogue is recommended for internal APIs.</p>
<p><strong>Required</strong></p>
<p>Publishing to a catalogue is required for external APIs.</p>
<ol type="1">
<li><h2 id="architectural-and-deployment-patterns">Architectural and
Deployment Patterns</h2></li>
</ol>
<p>The table below identifies some architectural and deployment patterns
that bear further investigation. There are a number of vendor specific
references that are also available however this document does not
recommend any particular one.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Pattern</th>
<th>Reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Microservices</td>
<td></td>
</tr>
<tr class="even">
<td><a
href="https://martinfowler.com/microservices/">https://martinfowler.com/microservices/</a></td>
<td></td>
</tr>
<tr class="odd">
<td>API Management</td>
<td></td>
</tr>
<tr class="even">
<td><a
href="https://nordicapis.com/understanding-api-management-api-gateway-and-api-manager/">https://nordicapis.com/understanding-api-management-api-gateway-and-api-manager/</a></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Observability</td>
<td><a
href="https://martinfowler.com/articles/domain-oriented-observability.html">https://martinfowler.com/articles/domain-oriented-observability.html</a><a
href="https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/ch04.html">https://www.oreilly.com/library/view/distributed-systems-observability/9781492033431/ch04.html</a></td>
</tr>
<tr class="odd">
<td>API Publication / Discovery</td>
<td></td>
</tr>
<tr class="even">
<td><a
href="https://apievangelist.com/2021/02/11/gathering-my-thoughts-on-api-discovery/">https://apievangelist.com/2021/02/11/gathering-my-thoughts-on-api-discovery/</a></td>
<td></td>
</tr>
<tr class="odd">
<td>Hybrid Deployments</td>
<td><a
href="https://nordicapis.com/making-sense-of-a-multi-cloud-api-approach/">https://nordicapis.com/making-sense-of-a-multi-cloud-api-approach/</a></td>
</tr>
<tr class="even">
<td>Service Mesh</td>
<td><a
href="https://nordicapis.com/introduction-to-service-mesh/">https://nordicapis.com/introduction-to-service-mesh/</a><a
href="https://www.oreilly.com/library/view/the-enterprise-path/9781492041795/ch01.html">https://www.oreilly.com/library/view/the-enterprise-path/9781492041795/ch01.html</a></td>
</tr>
</tbody>
</table>
<p><em>Table 20: Architectural and Deployment Patterns</em></p>
<ol type="1">
<li><h2 id="http-verbs">HTTP Verbs</h2></li>
</ol>
<p>Access to REST APIs must be via the standard HTTP verbs: GET, PUT,
POST, DELETE in line with the <a
href="https://www.w3.org/2001/tag/doc/whenToUseGet.html">W3C
Standard</a> namely:</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Verb</strong></th>
<th><strong>Common Usage</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GET</td>
<td>For retrieval of informationIf the interaction is more like a
question (i.e. it is a safe operation such as a query)</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>POST</td>
<td>To create a piece of information or resource itemTo spawn an action
If the interaction is like placing an orderIf the interaction changes
the state of the resource in a way that the user would perceive (e.g. a
subscription to a service)If the user be held accountable for the
results of the interaction</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>PUT</td>
<td>To update an existing resource itemTo replace an existing resource
item</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>DELETE</td>
<td>To delete a resource item</td>
</tr>
<tr class="even">
<td>OPTIONS</td>
<td></td>
</tr>
<tr class="odd">
<td>To retrieve information about what the consumer is allowed to do
with the resource</td>
<td></td>
</tr>
<tr class="even">
<td>PATCH</td>
<td>Not recommended due to complexity</td>
</tr>
<tr class="odd">
<td>HEAD</td>
<td>Rarely used, but used to retrieve metadata about a resource</td>
</tr>
</tbody>
</table>
<p>Table 22: HTTP Verbs</p>
<ol type="1">
<li><h2 id="uri-construction">URI Construction</h2></li>
</ol>
<p>URI construction is important in that it is the door through which
consumers enter to obtain agency resources. It should be intuitive and
easy to guess what an endpoint does just by looking at the URI and HTTP
verb, without needing to see a query string. As basic guidance, endpoint
URLs should advertise resources, and avoid verbs.</p>
<p>In some situations an implemented standard may define the URI
structure for you. A good example of this is Fast Health
Interoperability Resources (FHIR) <a
href="https://www.hl7.org/fhir/resource.html">https://www.hl7.org/fhir/resource.html</a></p>
<pre><code>1.</code></pre>
<h3 id="api-offering">API Offering</h3>
<p><strong>Recommended</strong></p>
<p>Is it recommended that agencies make it clear in the URL that their
offering is an API:</p>
<p><strong>Example</strong></p>
<p>https:// <strong>api</strong>.example.govt.nz</p>
<pre><code>1.</code></pre>
<h3 id="version">Version</h3>
<p>APIs should have a clear indication of the version, so that
application developers can ensure they are using the appropriate version
for their consuming application.</p>
<p><strong>Recommended</strong></p>
<p>Header-based versioning is recommended (see section <a
href="#_heading=h.44bvf6o">2.10, API Version Control</a>); however, it
is recognised that some API infrastructure does not readily support
header-based versioning.</p>
<p>URL-based versioning is a viable alternative, as the version number
in the URL should only change when major revisions have been made and
the interface has changed substantially without backwards compatibility.
For URL-based versioning the URI should include /vN with the major
version (N) and v as a prefix. Agencies should not include minor version
numbers when using version numbers in the API paths.</p>
<p><strong>Template</strong></p>
<p>/v{version}/</p>
<p><strong>Example</strong></p>
<p>#Get details for provider id 123435 – version 1 of the API</p>
<p>GET https://api.example.govt.nz/v1/providers/12345</p>
<p>Accept: application/json</p>
<p>Host: api.example.govt.nz</p>
<p>#Get details for provider id 123435 – version 2 of the API</p>
<p>GET https://api.example.govt.nz/v2/providers/12345</p>
<p>Accept: application/json</p>
<p>Host: api.example.govt.nz</p>
<pre><code>1.</code></pre>
<h3 id="namespaces">Namespaces</h3>
<p>For APIs where an agency holds multiple responsibilities which may
result in overlapping resource naming (for example MBIE could have the
resource “accommodation” in two contexts:tenancy/contracts,
tourism/contracts) it is recommended that namespaces be used to avoid
any ambiguity. The namespace would be the first noun in the URI and
should reflect the function of government being offered by this API.
Namespaces may be singular or plural, depending on the situation.</p>
<p><strong>Template</strong></p>
<p>/{version}/{namespace}/</p>
<p><strong>Example</strong></p>
<p>/v1/biosecurity/</p>
<pre><code>1.</code></pre>
<h3 id="resources-and-sub-resources">Resources and Sub-resources</h3>
<p><strong>Recommended</strong></p>
<p>Resource names should be noun-based, and collection resource names
should be plural nouns, e.g. /passengers in lower case. Resource naming
should be short, simple and clearly understandable. It should also be
human-guessable, avoiding technical or specialist terms where
possible.</p>
<p>Sub-resources must appear under the resource they relate to, but
should go no more than three deep
i.e. /resource/id/sub-resource/id/sub-sub-resource. If you reach a third
level of granularity (sub-sub-resource), it may be worth reviewing your
resource construction to see if it is actually a combination of multiple
first or second level resources.</p>
<p>The URI references for resources should consistently use the same
path structure to refer to resources. Sub-namespace or sub-folders
should be avoided, to maintain path consistency. This allows application
developers to have a predictable experience in case they are building
URIs in code.</p>
<p><strong>Template</strong></p>
<p>/{version}/{namespace}/{resource}/{resource-id}/{sub-resource}/{sub-resource-id}</p>
<p>/{version}/{resource}/{resource-id}/{sub-resource}/{sub-resource-id}</p>
<p><strong>Example</strong></p>
<p>https://api.example.govt.nz/v2/biosecurity/trusted-travellers/33245/arrivals/P100782</p>
<p>https://api.example.govt.nz/v2/learners/43265/achievements/7281</p>
<pre><code>1.</code></pre>
<h3 id="word-separation">Word Separation</h3>
<p>Hyphens have traditionally been used as word separators in URLs, as
search engines (particularly Google) prefer a hyphen to split words
because a hyphen is not a word character (as defined in regular
expression language). This has led to hyphens, or kebab-case, being the
de facto standard in the interests of readability and Search Engine
Optimization (SEO).</p>
<p>Therefore, in order to keep URLs consistently formatted, path and
query string parameters should be lower case with hyphen separators for
multiword names.</p>
<p><strong>Example</strong></p>
<p>https://api.example.govt.nz/v1/example-service/search?sort-order=asc</p>
<pre><code>1.</code></pre>
<h3 id="query-arguments">Query Arguments</h3>
<p>Query arguments should be used to filter a response i.e. modify a
returning result set.</p>
<p>The general rule is:</p>
<ul>
<li>If it changes the behaviour of the result set then it should be a
query argument</li>
<li>If it changes the behaviour of the API then it should be in the
path</li>
</ul>
<p>Query arguments are generally used for:</p>
<ul>
<li>Sorting or ordering the result set - e.g. sort-order=ascending</li>
<li>Pagination - pagination is a query argument because it effectively
acts as a filter and limits the result set returned. This is
particularly useful with large response data sets. When using pagination
it is a good idea to inform the consumer where they can find previous
and subsequent result sets using hypermedia as discussed in <a
href="#_heading=h.l7a3n9">section 2.7.7</a> of this document.</li>
</ul>
<p><strong>Example</strong></p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “next”,</p>
<p>“href”:
“https://api.example.govt.nz/v1/example-service/search?limit=5&amp;start=5”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “prev”,</p>
<p>“href”:
“https://api.example.govt.nz/v1/example-service/search?limit=5&amp;start=0”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”: “http://api.example.govt.nz/v1/example-service/search”</p>
<p>}</p>
<p>]</p>
<ul>
<li>Limiting the result set - e.g. by specifying which fields to return.
This approach can be complicated and is often a decision based on
functionality vs complexity. For example, it may be desirable to be able
to filter a result set to a specific set of objects. Whilst this is
possible, it is not a recommended approach. If this kind of flexibility
is required in an API it could be a good time to consider the use of <a
href="http://www.odata.org/">Open Data Protocol (OData</a>).</li>
<li>In cases where response filtering is used, providers should ensure
that they use a JSON schema by default so that consumers have the
ability to understand the entire resource and do not need to query the
resource for the message structure.</li>
</ul>
<p><strong>Example</strong></p>
<p>#Get a filtered result set for a learner</p>
<p>GET
https://api.example.govt.nz/v2/learners/33245?fields=firstName,lastName,dateOfBirth</p>
<p>{</p>
<p>“firstName”: “Mary”,</p>
<p>“lastName”: “Contrary”,</p>
<p>“dateOfBirth”: “12-01-1974”,</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”:
“https://api.example.govt.nz/v2/learners/33245?fields=firstName,lastName,dateOfBirth”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<ol type="1">
<li><h2 id="http-headers">HTTP Headers</h2>
<ol type="1">
<li><h3 id="request-headers">Request Headers</h3></li>
</ol></li>
</ol>
<table style="width:100%;">
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>Header</th>
<th>Usage</th>
<th>GET</th>
<th>POST</th>
<th>PUT</th>
<th>DELETE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Accept</td>
<td>Indicates desired format of the responseIf set to a value that
cannot be supported by the server, API responds with 406 (not
acceptable)</td>
<td>Required</td>
<td>Required</td>
<td>Required</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>Content-Type</td>
<td>Indicates the format of the payload provided on the requestIf not
supported by the server, API responds with 415 (Unsupported Media
Type)</td>
<td>N/A</td>
<td>Required</td>
<td>Required</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>Authorization</td>
<td>To provide authorization information – type and token, depending on
authorization typeIf token is not valid for the request, API responds
with 401 (Unauthorized)</td>
<td>Required, unless a public API</td>
<td>Required, unless a public API</td>
<td>Required, unless a public API</td>
<td>Required, unless a public API</td>
</tr>
<tr class="even">
<td>Accept-Encoding</td>
<td>Advertises what compression algorithm the consuming application is
able to understandIf encoding not supported by the server, API responds
with uncompressed response</td>
<td>Should use</td>
<td>Should use, if response body expected</td>
<td>Should use, if response body expected</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>{API Key Header}</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Note: there is no set naming standard for an API Key Header | Send
the API Keys with every requestIf keys are not valid, API response with
401 (Not authorised) | Required, if issued | Required, if issued |
Required, if issued | Required, if issued | |
If_Modified_Since/If-None-Match | Makes the request conditional; the
server will respond with the resource only if the specified condition is
met. If condition is not met, API responds with 304 (Not Modified) |
Should use | N/A | N/A | N/A | | {Request tracking Headers}</p>
<p>Note: there is no set naming standard for a transaction ID header |
Unique identifier that can be used to trace a request throughout its
lifecycle | Should use | Should use | Should use | Should use |</p>
<p><em>Table 22: Request Headers</em></p>
<pre><code>1.</code></pre>
<h3 id="response-headers">Response Headers</h3>
<table style="width:100%;">
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>Response Headers</th>
<th>Usage</th>
<th>GET</th>
<th>POST</th>
<th>PUT</th>
<th>DELETE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Content-Type</td>
<td>Indicates the format type of the response</td>
<td>Required</td>
<td>Required, if response body returned</td>
<td>Required, if response body returned</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>Location</td>
<td>Indicates the absolute URI of the newly created resource item</td>
<td>Required for 302 redirect</td>
<td>Should use, if resource created</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>Content-Location</td>
<td>Indicates the absolute URI of the requested resource</td>
<td>Should use</td>
<td>Should use, if resource returned</td>
<td>Should use</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>Cache-Control</td>
<td>Directives to control caching behaviour external to the API layer
(e.g. CDN caching)</td>
<td>Should use</td>
<td>Should use</td>
<td>Should use</td>
<td>N/A</td>
</tr>
<tr class="odd">
<td>Expires</td>
<td>Used in conjunction with Cache-Control for backwards
compatibility</td>
<td>Should use</td>
<td>Should use</td>
<td>Should use</td>
<td>N/A</td>
</tr>
<tr class="even">
<td>ETag</td>
<td>Concurrency control header</td>
<td>Should use</td>
<td>Should use</td>
<td>Should use</td>
<td>Should use</td>
</tr>
</tbody>
</table>
<p><em>Table 23: Response Headers</em></p>
<pre><code>1.</code></pre>
<h3 id="customer-x-http-headers">Customer X-HTTP Headers</h3>
<p>X- notation headers have been deprecated as per <a
href="https://tools.ietf.org/html/rfc6648">RFC6648</a> # 1 and should
not be used. This standard appreciates that X- notation headers are
widely used however this document recommends that where an agency is
defining a custom header the X- notation should not be used and the
agency defines a custom header notation that is relevantit relevant. For
example, <em>X-Request-Id</em> should be redefined as
<em>Request-Id</em>.</p>
<ol type="1">
<li><h2 id="returned-content">Returned Content</h2></li>
</ol>
<p>The returned content is the body of the message that the API returns
in response to a request. This usually relates to the resource that was
requested.</p>
<pre><code>1.</code></pre>
<h3 id="resource-scope">Resource Scope</h3>
<p>The amount of data to return about a resource depends on several
factors:</p>
<ul>
<li>Business context - does all the resource information being returned
have relevance to the business process or activity consumers will use it
for?</li>
<li>Payload size and network efficiency - how much information does the
resource contain, and is it so bulky it could impact network
performance?</li>
<li>Usefulness - is the information in the returned content always
useful to the consumer, or is it something they may need once but never
again?</li>
</ul>
<p>Analysis of the full resource data against these factors should help
determine how much resource data is returned in the response.</p>
<pre><code>1.</code></pre>
<h3 id="formats">Formats</h3>
<p>REST responses should be of a format which is both human and machine
readable. Even if your initial consumer is via B2B, the API should be
designed, where possible, for all potential consumers. REST APIs should,
by default, return content in JSON format. But it is good practice to
support multiple message formats (e.g. XML, Multi-part MIME) and allow
consuming applications to request the format they wish to consume (in
line with the “Design for the Consumer” principle in Part A, section
4).</p>
<p>The response format required from a GET request must be indicated by
the consumer in their request using the Accept header. For example:</p>
<p>#GET a resource and specify the response type</p>
<p>https://api.example.govt.nz/crown-property/0219c539-5885-4ab6-a55b-b0de7537c426</p>
<p>Accept: application/xml</p>
<p>#Response</p>
<p>&lt;?xml version=“1.0” encoding=“UTF-8” ?&gt;</p>
<p>&lt;CrownProperyResponseBody
xmlns=“https://api.example.com/CrownProperyResponse”&gt;</p>
<p>&lt;id&gt;0219c539-5885-4ab6-a55b-b0de7537c426&lt;/id&gt;</p>
<p>&lt;category&gt;commercial&lt;/category&gt;</p>
<p>&lt;location&gt;</p>
<p>&lt;streetName&gt;Northbound Boulevard&lt;/streetName&gt;</p>
<p>&lt;town&gt;Wellington&lt;/town&gt;</p>
<p>&lt;postalCode&gt;6011&lt;/postalCode&gt;</p>
<p>&lt;countryCode&gt;NZ&lt;/countryCode&gt;</p>
<p>&lt;/location&gt;</p>
<p>&lt;pricing&gt;</p>
<p>&lt;rentFrequency&gt;annual&lt;/rentFrequency&gt;</p>
<p>&lt;currencyCode&gt;NZD&lt;/currencyCode&gt;</p>
<p>&lt;pricePerUnitArea&gt;</p>
<p>&lt;price&gt;1000&lt;/price&gt;</p>
<p>&lt;units&gt;squareMetre&lt;/units&gt;</p>
<p>&lt;/pricePerUnitArea&gt;</p>
<p>&lt;transactionType&gt;rent&lt;/transactionType&gt;</p>
<p>&lt;/pricing&gt;</p>
<p>&lt;property_type&gt;office&lt;/property_type&gt;</p>
<p>&lt;areas&gt;</p>
<p>&lt;internal&gt;</p>
<p>&lt;minimum&gt;</p>
<p>&lt;value&gt;183&lt;/value&gt;</p>
<p>&lt;units&gt;squareMetre&lt;/units&gt;</p>
<p>&lt;/minimum&gt;</p>
<p>&lt;maximum&gt;</p>
<p>&lt;value&gt;188&lt;/value&gt;</p>
<p>&lt;units&gt;squareMetre&lt;/units&gt;</p>
<p>&lt;/maximum&gt;</p>
<p>&lt;/internal&gt;</p>
<p>&lt;/areas&gt;</p>
<p>&lt;detailedDescription&gt;</p>
<p>&lt;text&gt;Free text describing the property in some
way.&lt;/text&gt;</p>
<p>&lt;/detailedDescription&gt;</p>
<p>&lt;tenancy&gt;</p>
<p>&lt;life_cycle_status&gt;tennanted&lt;/life_cycle_status&gt;</p>
<p>&lt;nextReviewDate&gt;2016-06-01&lt;/nextReviewDate&gt;</p>
<p>&lt;/tenancy&gt;</p>
<p>&lt;/CrownProperyResponseBody&gt;</p>
<p>The request format for a request containing a request body (POST,
PUT, PATCH) must be supplied in the Content-Type request header. For
example:</p>
<p>#PUT (update) a resource</p>
<p>https://api.example.govt.nz/crown-property</p>
<p>Content-Type: application/json</p>
<p>Accept: application/json</p>
<p>#Request BODY</p>
<p>{</p>
<p>“id”: “0219c539-5885-4ab6-a55b-b0de7537c426”,</p>
<p>“category”: “commercial”,</p>
<p>“location”: {</p>
<p>“streetName”: “Northbound Boulevard”,</p>
<p>“town”: “Wellington”,</p>
<p>“postalCode”: “6011”,</p>
<p>“countryCode”: “NZ”</p>
<p>},</p>
<p>“pricing”: {</p>
<p>“rentFrequency”: “annual”,</p>
<p>“currencyCode”: “NZD”,</p>
<p>“pricePerUnitArea”: {</p>
<p>“price”: 1000,</p>
<p>“units”: “squareMetre”</p>
<p>},</p>
<p>“transactionType”: “rent”</p>
<p>},</p>
<p>“property_type”: “office”,</p>
<p>“areas”: {</p>
<p>“internal”: {</p>
<p>“minimum”: {</p>
<p>“value”: 183,</p>
<p>“units”: “squareMetre”</p>
<p>},</p>
<p>“maximum”: {</p>
<p>“value”: 188,</p>
<p>“units”: “squareMetre”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“detailedDescription”: [</p>
<p>{</p>
<p>“text”: “Free text describing the property in some way.”</p>
<p>}</p>
<p>],</p>
<p>“tenancytennancy”: {</p>
<p>“life_cycle_status”: “vacant”,</p>
<p>“nextReviewDate”: “2016-07-01”</p>
<p>}</p>
<p>}</p>
<p>For a good example of this in action, see the tabbed format options
for presenting patient information on the FHIR # 2 site.</p>
<p>Where JSON format is used in responses, it must conform to the JSON
Standard (<a href="https://tools.ietf.org/html/rfc7159">RFC7159</a> # 3
). In line with this standard, textual content should be UTF-8 encoded
by default, and any deviations from this must be limited.</p>
<p>It is inadvisablein inadvisable to use APIs for returning binary data
such as images in the response content; hyperlinks to images are the
preferred returned response. But where images <em>are</em> returned,
ensure that the image encoding is MIME, HTTP Multipart.</p>
<p>HTML is allowed, but is less flexible for consumer usage (e.g. how
can it be consumed by a native mobile app?), ties content to
presentation and loses its benefits when building a single page
application. It also reduces the ability to filter the content in
transit for consumers who have fine grained control on what they can
access. However, it may be necessary for some forms of API e.g. APIs
with geospatial content.</p>
<p>Avoid using bespoke formats in returned content.</p>
<p><strong>Recommended</strong></p>
<p>Returned content format should be JSON by default.</p>
<p><strong>Required</strong></p>
<p>Requests for a specific return format must be defined in the Accept
header.</p>
<pre><code>1.</code></pre>
<h3 id="layout">Layout</h3>
<p>Responses should be a JSON object (not an array) by default. Using an
array to return results limits the ability to include metadata about
results and limits the API’s ability to add additional top-level
properties in the future. Don’t use unpredictable properties. Parsing a
JSON response where properties are unpredictable (e.g. derived from
data) is difficult, and adds friction for clients.</p>
<p><strong>Example of good layout</strong></p>
<p>{</p>
<p>“response_meatadata”: {</p>
<p>“item1”: “value1”,</p>
<p>“item2”: “value2”</p>
<p>},</p>
<p>“responseArray”: [</p>
<p>{</p>
<p>“name”: “entity1”,</p>
<p>“type”: “good”</p>
<p>},</p>
<p>{</p>
<p>“name”: “entity2”,</p>
<p>“type”: “good”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p><strong>Example of bad layout</strong></p>
<p>[</p>
<p>{</p>
<p>“name”: “entity1”,</p>
<p>“type”: “bad”</p>
<p>},</p>
<p>{</p>
<p>“name”: “entity2”,</p>
<p>“type”: “bad”</p>
<p>}</p>
<p>]</p>
<pre><code>1.</code></pre>
<h3 id="json-property-names">JSON Property Names</h3>
<p>Within content, property names should conform to the following
guidelines:</p>
<ul>
<li><p>Property names should be meaningful names with defined
semantics</p></li>
<li><p>Property names must be camel-case ASCII strings</p></li>
<li><p>The first character must be a letter or underscore (_)</p></li>
<li><p>Subsequent characters can be a letter, a digit, or
underscore</p></li>
<li><p>Reserved JavaScript keywords should be avoided</p>
<ol type="1">
<li><h3 id="consistency">Consistency</h3></li>
</ol></li>
</ul>
<p>Preserve backwards compatibility with existing consumers of the API
by returning expected fields and employing sensible default values for
missing fields. Keep consistency of terminology throughout, so that the
consumer is not misled. Avoid modifying the semantics of content to new
meanings, e.g. don’t change a ‘title’ field from meaning the title of
the page, to meaning the prefix for a name to the person’s job
title.</p>
<pre><code>1.</code></pre>
<h3 id="singletons-vs.-collections">Singletons vs. Collections</h3>
<p>Some API GET calls will return a single resource item (e.g. GET
https://api.example.govt.nz/passengers/12345) whereas some calls will
return a collection of resource items (e.g. GET
https://api.example.govt.nz/passengers), and the handling and error
treatment can be different.</p>
<p>A single item will generally consist of all the pertinent fundamental
details about the resource, and the GET will return these fundamental
details.</p>
<p><strong>Example</strong></p>
<p>#GET a single passenger resource by ID</p>
<p>GET <a
href="https://api.example.govt.nz/passengers/12345">https://api.example.govt.nz/passengers/12345</a></p>
<p>Accept: application/json,version=1.*</p>
<p>{</p>
<p>“id”: 12345,</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“preferredName”: “Howie”,</p>
<p>“title”: “Mr”</p>
<p>},</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: “home”,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111</p>
<p>},</p>
<p>{</p>
<p>“type”: “business”,</p>
<p>“address1”: “2 Work Street”,</p>
<p>“address2”: “Work Suburb”,</p>
<p>“address3”: “Work City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 2222</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>If passenger 12345 did not exist, the HTTP return code would be
404.</p>
<p>If a requested sub resource did not exist e.g. addresses for
passenger 54321: GET
https://api.example.govt.nz/passengers/54321/addresses an HTTP 404
response would not be valid. The correct response would contain an empty
array:</p>
<p>#GET a single passenger address resource by ID</p>
<p>GET https://api.example.govt.nz/passengers/54321/addresses</p>
<p>Accept: application/json,version=1.*</p>
<p>{</p>
<p>“id”: 54321,</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: null,</p>
<p>“address1”: null,</p>
<p>“address2”: null,</p>
<p>“address3”: null,</p>
<p>“address4”: null,</p>
<p>“country”: null,</p>
<p>“postcode”: null</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>A collection will take the form of an array of the given resources,
including any related metadata. The collection returned should be the
complete set, leaving it to the consumer to reduce the quantity of
information returned by sending filters in the resource request (see <a
href="#_heading=h.3ls5o66">section 2.5.6, Query Arguments</a>). The only
reason the collection should be filtered by the API provider is based on
the security context; the API consumer should only gain access to what
that consumer is allowed to see. It is advisable to aim for consistent
naming of collection resource fields, as this enables application
developers to create generic handling of the data from across various
resource collections offered by the API. Collection resources should not
contain binary attachments or other content that will lead to large
response payloads.</p>
<p>Note that the example below is contrived and it would be rare to
expose a resource collection as large as passengers.</p>
<p><strong>Example</strong></p>
<p>#GET a collection of passenger resources</p>
<p>GET <a
href="https://api.example.govt.nz/passengers">https://api.example.govt.nz/passengers</a></p>
<p>Accept: application/json,version=1.*</p>
<p>{</p>
<p>“passengers”: [</p>
<p>{</p>
<p>“id”: 12345,</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>“id”: 98765,</p>
<p>“names”: {</p>
<p>“firstName”: “Mary”,</p>
<p>“middleName”: “Pauline”,</p>
<p>“lastName”: “Smith”,</p>
<p>“salutation”: “Ms Mary Smith”,</p>
<p>“title”: “Ms”</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>“…..lots more passengers here…..”: “…”</p>
<p>}</p>
<p>],</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “12345”,</p>
<p>“href”: “https://api.example.govt.nz/passengers/12345”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “98765”,</p>
<p>“href”: “https://api.example.govt.nz/passengers/98765”</p>
<p>},</p>
<p>{</p>
<p>“…..lots more links here…..”: “…”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>If there were no results from a query against a filter,
e.g. passengers booked on a specific flight (GET
https://api.example.govt.nz/passengers/flights/1234), the return value
would be a 200 response code, because the query is not invalid and there
may be such data in the future.</p>
<pre><code>1.</code></pre>
<h3 id="hateoas">HATEOAS</h3>
<p>HATEOAS, or Hypermedia as the Engine of Application State, is the
principle of not just returning a response to a request, but also
returning links to other useful capabilities. So, if a POST has just
been used to create an item, the response could return links to options
to update the item, delete the item and view other items of the same
type. This makes it possible for UIs which utilise an API to be
automatically generated (in terms of hyperlinks) and adaptable to change
(response content links).</p>
<p>If a web page effectively captures a single state in time, then
hyperlinks are transitions to other states. The HATEOAS principle
suggests that REST should return not only response content (current
state) but also links to transitions to other states. This could result
in thinner clients and fatter APIs, and means UIs need to be built to
adapt to potential new transitions, but makes it possible to update all
UIs no matter what platform they sit on (mobile app, web application
etc.).</p>
<p>For example, consider the following representation of a person and
sequence of requests:</p>
<p>This example assumes that an address is a unique resource in its own
right and that people are associated with addresses. (This may not
always be a practical application and the example is used just to
illustrate the hypermedia concept.)</p>
<p><strong>1. User submits a request for a person record:</strong></p>
<h1 id="request-person-details">Request person details:</h1>
<p>GET
https://api.example.govt.nz/people/c70d37cf-3314-4a24-a2c3-0fca7ec0943f</p>
<p>Host: www.example.com</p>
<p>Accept: application/json;q=1.0</p>
<h1 id="response-with-person-details">Response with person details:</h1>
<p>HTTP/1.1 200 OK</p>
<p>Content-Location:
https://api.example.govt.nz/people/c70d37cf-3314-4a24-a2c3-0fca7ec0943f</p>
<p>Content-Type: application/json;charset=UTF-8</p>
<p>Cache-control: max-age=3600,must-revalidate</p>
<p>{</p>
<p>“personId”: “d9e1a2f6-6bc9-46af-9dbb-50de7f6eacd5”,</p>
<p>“name”: “Joe Bloggs”,</p>
<p>“email”: “joe.bloggs@example.com”,</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“id”: “5046b8f2-e8aa-4ec9-a597-34d01af0fd32”,</p>
<p>“streetNumber”: “12”,</p>
<p>“streetName”: “Somewhere Street”,</p>
<p>“City”: “Springfield”,</p>
<p>“type”: “home”</p>
<p>},</p>
<p>{</p>
<p>“id”: “18a1a85c-3b1e-41b9-909c-668f2a803b69”,</p>
<p>“streetNumber”: “1”,</p>
<p>“streetName”: “Some Other Street”,</p>
<p>“City”: “Springfield”,</p>
<p>“type”: “business”</p>
<p>}</p>
<p>],</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”:
“https://api.example.govt.nz/people/d9e1a2f6-6bc9-46af-9dbb-50de7f6eacd5”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “address1”,</p>
<p>“href”:
“https://api.example.govt.nz/addresses/046b8f2-e8aa-4ec9-a597-34d01af0fd32”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “address2”,</p>
<p>“href”:
“https://api.example.govt.nz/addresses/18a1a85c-3b1e-41b9-909c-668f2a803b69”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>Assume an intermediate proxy were to cache that response as directed
by the cache control header.</p>
<p><strong>2. The user then updates the address details changing the
street number:</strong></p>
<h1 id="request-to-update-the-address-details">Request to update the
address details:</h1>
<p>PUT
https://api.example.govt.nz/addresses/d9e1a2f6-6bc9-46af-9dbb-50de7f6eacd5
HTTP/1.1</p>
<p>Host: api.example.govt.nz</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>“streetNumber”: “12a”,</p>
<p>“streetName”: “Somewhere Street”,</p>
<p>“City”: “Springfield”</p>
<p>}</p>
<h1 id="response-that-the-update-was-successful">Response that the
update was successful:</h1>
<p>HTTP/1.1 204 No Content</p>
<p>Location:
https://api.example.govt.nz/addresses/046b8f2-e8aa-4ec9-a597-34d01af0fd32</p>
<p>If the user were now to re-fetch the person details again as per step
1, the representation would contain a stale version of the address
(street number 12 instead of 12a) because the address representation had
been cached. This caching could occur anywhere along the network path
(including public internet) between the server and client.</p>
<p>Using hypermedia links for related resources improves the visibility
of the API and avoids these types of problems. Consider the revised
person representation below:</p>
<p>{</p>
<p>“personId”: “d9e1a2f6-6bc9-46af-9dbb-50de7f6eacd5”,</p>
<p>“name”: “JoeBloggs”,</p>
<p>“email”: “joe.bloggs@example.com”,</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”:
“https://api.example.govt.nz/addresses/5046b8f2-e8aa-4ec9-a597-34d01af0fd32”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”:
“https://api.example.govt.nz/addresses/18a1a85c-3b1e-41b9-909c-668f2a803b69”</p>
<p>}</p>
<p>],</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”:
“https://api.example.govt.nz/people/d9e1a2f6-6bc9-46af-9dbb-50de7f6eacd5”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>Using this approach, the embedded object is replaced with a link to
the “real” object. Although this approach requires a larger number of
network requests, it avoids the stale data problems and reduces payload
size, which is an important consideration for APIs being used by mobile
devices or over high latency networks.</p>
<ol type="1">
<li><h2 id="consideration-of-state">Consideration of state</h2></li>
</ol>
<p>In almost all cases a REST API should be entirely stateless. As part
of processing it is possible for an API to gather context and pass this
to a downstream system, however an API should not maintain that context
for future requests. This should not be confused with caching, as
discussed in <a href="#_heading=h.2pta16n">section 2.12</a> of this
document.</p>
<ol type="1">
<li><h2 id="batch-handling-transactions">Batch Handling &amp;
Transactions</h2></li>
</ol>
<p>APIs are not designed for large payloads i.e. batch handling for
retrieving or uploading batches of data. APIs are geared towards
stateless, usually synchronous, web-like requests for individual
discrete data transactions. However, batch handling can be achieved
through bundling multiple calls to the same API. This helps achieve
atomicity of transactions and aids recoverability in event of errors. #
4</p>
<p>When handling transactions, it is important to consider the
troubleshooting and recovery aspects of error handling. This includes
visibility of transaction progress and the ability to perform root cause
analysis. To achieve this, it is advisable that logging is performed on
all transactions coming through an API, with accurate timestamping, so
that monitoring tools can visualise transaction progress. It also
requires transaction identifiers (See <a
href="#_heading=h.4kx3h1s">section 2.6.1,</a><a
href="#_heading=h.4kx3h1s">Request Headers</a>) to be built into
transactional API calls to ensure the transaction is traceable
end-to-end.</p>
<p>In some cases, it may be deemed appropriate to provide an
asynchronous batch type capability using an API. This would usually be
implemented in a scenario where legacy system impact is a concern. An
example of this could be a bulk creation of person records in a database
based on a batch event in a consuming legacy application. In such a
scenario it would be preferable for the consuming application to treat
each person as a unique event and to POST to a person API for each new
unique resource. Whilst this may seem like an unnecessary overhead, by
individualising the transactions each success or error scenario can be
handled in its own right, and the consumer can be informed of their
transaction status. If this is not possible, due to some system
restriction, it is possible to asynchronously POST multiple person
details to an API. This type of interaction should not be attempted
synchronously as large batches will tie up HTTP threads and in some
cases require client/server timeout control.</p>
<p><strong>Example Request</strong></p>
<p>The following is an example of a singleton create person request:</p>
<p>{</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>}</p>
<p>}</p>
<p>This is an example of a bulk person create API call:</p>
<p>#POST a collection of person resources</p>
<p>POST https://api.example.govt.nz/people</p>
<p>Accept: application/json,version=1.*</p>
<p>{</p>
<p>“people”: [</p>
<p>{</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>“names”: {</p>
<p>“firstName”: “Mary”,</p>
<p>“middleName”: “Pauline”,</p>
<p>“lastName”: “Smith”,</p>
<p>“salutation”: “Ms Mary Smith”,</p>
<p>“title”: “Ms”</p>
<p>}</p>
<p>},</p>
<p>{</p>
<p>“…..lots more people here…..”: “…”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p><strong>Example Response</strong></p>
<p>Note that the API is unable to respond with headers such as Location
as this request should be treated as asynchronous.</p>
<p>200 OK</p>
<ol type="1">
<li><h2 id="api-version-control">API Version Control</h2>
<ol type="1">
<li><h3 id="api-version-control-methods">API Version Control
Methods</h3></li>
</ol></li>
</ol>
<p>There are two main API versioning methodologies commonly used. There
are positives and negatives to both approaches and a large amount of
debate over which is the most “RESTful”. Rather than stipulate a
methodology to use in this standard, below is a description of each
methodology in order of preference. Both, however, are acceptable. What
is more important is that APIs are versioned and that there is an
understanding of when and why to version an API.</p>
<pre><code>  1.</code></pre>
<h4 id="accept-header-versioning">Accept Header Versioning</h4>
<p>This is usually considered the most RESTful way to version APIs
because the resource path remains “pure” and it is possible to provide
more version flexibility for clients. It is, however, technically more
difficult to implement, and in many cases commercial API
management/gateway products do not support or work well with this
approach.</p>
<p>Header based versioning should be performed using the Accept header
where a consuming application requests an API version as defined in an
Accept header. Wildcards (*) are used by the consuming application to
indicate acceptance of the latest major or minor version of an API.</p>
<p><strong>Example</strong></p>
<p>#Get details for provider id 123435 – latest minor version of the
API</p>
<p>GET https://api.example.govt.nz/providers/12345</p>
<p>Accept: application/json, version=1.*</p>
<p>Host: api.example.govt.nz</p>
<p>#Get details for provider id 123435 –version 1.1 of the API</p>
<p>GET https://api.example.govt.nz/providers/12345</p>
<p>Accept: application/json, version=1.1</p>
<p>Host: api.example.govt.nz</p>
<p>#Get details for provider id 123435 – latest version of the API</p>
<p>GET https://api.example.govt.nz/providers/12345</p>
<p>Accept: application/json, version=*</p>
<p>Host: api.example.govt.nz</p>
<p>The response should include the version of the API that responded to
the client request in the <strong>Content-Type</strong> header.</p>
<p><strong>Example</strong></p>
<p>Content-Type: application/json,version=1.2</p>
<pre><code>  1.</code></pre>
<h4 id="uri-path-versioning">URI (Path) Versioning</h4>
<p>URL-based versioning is a viable alternative, as the version number
in the URL should only change when major revisions have been made and
the interface has changed substantially without backwards compatibility.
For URL-based versioning the URI should include /vN with the major
version (N) and v as a prefix. Agencies should not include minor version
numbers when using version numbers in the API paths.</p>
<p>This is probably the easiest method to implement, but a number of
REST purists feel that it compromises the URI and does not offer enough
flexibility to consumers. If there is a requirement to support a large
number of historical versions of APIs it can mean that there is
complexity introduced with the number of URIs to maintain.</p>
<p><strong>Example</strong></p>
<p>#Query version of version 1 of the search API</p>
<p>GET <a
href="https://api.example.govt.nz/customers/v1/search?first-name=John&amp;last-name=Smith&amp;page-size=10">https://api.example.govt.nz/customers/v1/search?first-name=John&amp;last-name=Smith&amp;page-size=10</a></p>
<p>#Query version 2 of the search API</p>
<p>GET
https://api.example.govt.nz/customers/v2/search?first-name=John&amp;last-name=Smith&amp;page-size=10</p>
<p>The response should still indicate the version of the API that was
called. This can be done as above, using the
<strong>Content-Type</strong> header or in the <strong>Location</strong>
header, as the version in the path indicates the API that was
called.</p>
<pre><code>1.</code></pre>
<h3 id="when-to-version">When to Version</h3>
<p>Simply put, an API should be versioned when a change is considered
breaking. One of the benefits of an API is that, if it is well designed,
there should be fewer breaking changes. In government however, there are
likely to be situations where legislative changes enforce a new version
of an API and deprecation of all previous versions.</p>
<pre><code>  1.</code></pre>
<h4 id="breaking-changes">Breaking Changes</h4>
<p>A change is a breaking change if any consuming application requires
changes to work with the new version. i.e. the new version will not
successfully process messages provided by existing consumers. A breaking
change should be considered as a major version change e.g. 1.3 to
2.0.</p>
<p>Examples of breaking changes include:</p>
<ul>
<li><p>The removal of any property from the response
representation</p></li>
<li><p>The change of datatype for an existing property, or a change from
optional to required</p></li>
<li><p>The removal of any resource, or HTTP Verb support</p></li>
<li><p>A change to the way errors are handled</p></li>
<li><p>Any change to existing resource URIs</p>
<pre><code>1.</code></pre>
<h4 id="non-breaking-changes">Non-Breaking Changes</h4></li>
</ul>
<p>A change is non-breaking change if any message that would have been
processed by the previous version will be successfully processed by the
new version (i.e. backwards compatible). This will enable an existing
consumer of the previous version to work with the new version without
requiring modification. A non-breaking change should be considered as a
minor version change e.g. 1.1 to 1.2.</p>
<p>Such changes include:</p>
<ul>
<li><p>The addition of new properties to the JSON
representation</p></li>
<li><p>The addition of new resources</p></li>
<li><p>The addition of support for new HTTP Verbs (new operations) on
existing resources</p></li>
<li><p>Support for new custom headers, e.g. for request tracing</p>
<ol type="1">
<li><h3 id="software-configuration-management">Software Configuration
Management</h3></li>
</ol></li>
</ul>
<p>It is important to remember that version control is more than just
versioning the resource. An API will inherently have associated code and
artefacts. Consider what comprises an API and include these as a logical
artefact stored and managed in a software configuration management (SCM)
system. It is a good idea to try and capture all components in a format
that can be controlled by SCM. A good example of this is UML diagrams;
these cannot be version controlled unless captured in a text like
format. See <a
href="http://www.planttext.com/planttext">http://www.planttext.com/planttext</a>
or <a
href="https://www.websequencediagrams.com/">https://www.websequencediagrams.com</a>
for examples of textualexamples textual UML modelling.</p>
<p>An API artefact should, where possible, comprise the following:</p>
<ul>
<li><p>Any API code</p></li>
<li><p>API specification (OpenAPI)</p></li>
<li><p>Unit test scripts such as <a
href="http://junit.org/junit5/">JUnit</a> or <a
href="https://mochajs.org/">Mocha</a>.</p></li>
<li><p>Continuous integration support files such as grunt.js or Ant
scripts.</p>
<ol type="1">
<li><h2 id="search">Search</h2></li>
</ol></li>
</ul>
<p>Search should be implemented using GET requests with filters provided
as query string parameters (see 2.4.6, Query Arguments). Search can be
used by API consumers to filter or sort information they want from an
API. For instance,GET /groups/search?status=activewould enable the
consumer to filter the groups resource on status. Alternatively,GET
/groups/search?status=active&amp;sort=status,nameenables the consumer to
return active groups ordered by status and name. It can also be useful
to allow the consumer to choose which fields they want back from the
API, so they only receive the content they need in the API response.</p>
<p><strong>Example</strong></p>
<p>#Get a list of groups that are either active or inactive, sorted
by</p>
<p>#name and status</p>
<p>GET
https://api.example.govt.nz/groups/search?status=active,inactive&amp;sort=name,status</p>
<p>{</p>
<p>“groups”: [</p>
<p>{</p>
<p>“id”: “0219c539-5885-4ab6-a55b-b0de7537c426”,</p>
<p>“name”: “API lovers”,</p>
<p>“status”: “active”</p>
<p>},</p>
<p>{</p>
<p>“id”: “1219c539-5885-4ab6-a55b-b0de7537c427”,</p>
<p>“name”: “Developers”,</p>
<p>“status”: “active”</p>
<p>},</p>
<p>{</p>
<p>“id”: “7219c539-5885-4ab6-a55b-b0de7537c42c”,</p>
<p>“name”: “Risk analysts”,</p>
<p>“status”: “active”</p>
<p>},</p>
<p>{</p>
<p>“id”: “3219c539-5885-4ab6-a55b-b0de7537c42h”,</p>
<p>“name”: “Writers”,</p>
<p>“status”: “active”</p>
<p>},</p>
<p>{</p>
<p>“id”: “g219c539-5885-4ab6-a55b-b0de7537c425”,</p>
<p>“name”: “Authors”,</p>
<p>“status”: “inactive”</p>
<p>}</p>
<p>],</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “self”,</p>
<p>“href”: “https://api.example.govt.nz/groups?sort=status,name”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “API Lovers”,</p>
<p>“href”:
“https://api.example.govt.nz/groups/0219c539-5885-4ab6-a55b-b0de7537c426”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “Developers”,</p>
<p>“href”:
“https://api.example.govt.nz/groups/1219c539-5885-4ab6-a55b-b0de7537c427”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “Risk analysts”,</p>
<p>“href”:
“https://api.example.govt.nz/groups/7219c539-5885-4ab6-a55b-b0de7537c42c”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “Writers”,</p>
<p>“href”:
“https://api.example.govt.nz/groups/3219c539-5885-4ab6-a55b-b0de7537c42h”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “Authors”,</p>
<p>“href”:
“https://api.example.govt.nz/groups/g219c539-5885-4ab6-a55b-b0de7537c425”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>In rare circumstances it is possible that an extremely complex search
API may run into query string or URL length limitations, although this
is probably an indication that the design of the search operation is too
complicated. The exact length limit is server and client dependent. For
example, the Apache server has a default limit of 8KB, Microsoft IIS has
a default of 16KB, and many browsers are limited to around 2KB maximum
URL length.</p>
<p>Where the total length can potentially exceed 2KB, the only option is
to implement the search operation using the POST verb with an
appropriately designed request object to contain the search
parameters.</p>
<p><strong>Template</strong></p>
<p>POST /{version}/{namespace}/{search-resource}</p>
<p><strong>Example Request</strong></p>
<p>POST /v1/people/person-search?page=5 HTTP/1.1</p>
<p>Host: www.example.com</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>“startDateBefore”:“2010-01-01”,</p>
<p>“position”: “Manager”,</p>
<p>“businessUnit”: “Operations”,</p>
<p>. . . many other search parameters . . .</p>
<p>}</p>
<p><strong>Example Response</strong></p>
<p>HTTP/1.1 200 OK</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>“pageSize”: 10,</p>
<p>“page”: 5,</p>
<p>“totalItems”: 77,</p>
<p>“totalPages”: 8,</p>
<p>“items”: [</p>
<p>. . . lots of people objects here . . .</p>
<p>]</p>
<p>“_links”: [</p>
<p>{</p>
<p>“rel”: “first”,</p>
<p>“href”: “https://www.example.com/v1/people/person-search?page=1”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “prev”,</p>
<p>“href”: ” https://www.example.com/v1/people/person-search?page=4”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “next”,</p>
<p>“href”: ” https://www.example.com/v1/people/person-search?page=6”</p>
<p>},</p>
<p>{</p>
<p>“rel”: “last”,</p>
<p>“href”: ” https://www.example.com/v1/people/person-search?page=8”</p>
<p>},</p>
<p>]</p>
<p>}</p>
<p>Other considerations include special characters or filters that add
additional complexity due to URL encoding requirements. For example, the
search function might need to support “&lt;” or “&gt;” operators, or
special characters for non-English language support. Additionally,
structured query language (SQL) words should be avoided as common threat
detection filters may block requests containing words such as ‘DROP’,
‘ALTER’ or ‘DELETE’ in case they are SQL injection attacks. See <a
href="https://www.owasp.org/index.php/XSS_Prevention_Cheat_Sheet">OWASP
XSS Cheat Sheet</a> and <a
href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet">OWASP
SQL Injection Cheat Sheet</a> for details.</p>
<p>Paging behaviour for search results should be consistent with the
interaction as described in <a href="#_heading=h.3ls5o66">section 2.5.6,
Query Arguments</a>. Pagination can be implemented as a page number and
page size, offset and limit, or continuation token, depending on the
scale and changeability of the search results.</p>
<p>Note: It is worth pointing out that since the HTTP protocol treats
POST operations as unsafe, the result is not cacheable. This applies
even if the response has a Cache-Control header included, so consider
the performance impacts on the API if this is a high-volumethis a
high-volume operation.</p>
<ol type="1">
<li><h2 id="caching-1">Caching</h2></li>
</ol>
<p>Caching enables faster responses from APIs and reduces server load.
It is good for information which is frequently requested but does not
change very often. The aim is to retrieve information once but re-use
many times.</p>
<p>There are a number of caching methodologies available. This section
focuses on two types of caching that should be owned and controlled by
the provider, primarily for APIs.</p>
<pre><code>1.</code></pre>
<h3 id="response-cache">Response Cache</h3>
<p>A response cache is a cache that contains the response to a GET
request on a unique resource. The response should be cached as close to
the consumer as possible while remaining inside the control boundaries
of the agency. Response caches are usually fast, in-memory caches. Many
off the shelf API gateway/management solutions provide a built-in
response cache. When using a response cache, agencies should ensure that
they understand and monitor their cache to ensure that stale objects are
kept to a minimum and that they have sufficient system memory to service
caching loads. This means ensuring that the cache is refreshed once a
user has updated the information or a cache timeout has occurred.</p>
<p>Consider the following example regarding response cache:</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_c1f69e9d15356236.png" /></p>
<p><em>Figure 50: Caching sequence diagram</em></p>
<pre><code>1.</code></pre>
<h3 id="object-cache">Object Cache</h3>
<p>An object cache is used to cache objects that are fundamental to the
function of an API but may not change on a regular basis. For example,
an API may include a tax code validation step. Tax code references are
held in a back-end database. To prevent redundant requests to the
database, the API layer could cache tax codes in its object cache and
refer to these until the cache becomes invalid. The diagram below
details an example sequence.</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_81068496e34d9ebb.png" /></p>
<p><em>Figure 51: Caching sequence diagram</em></p>
<ol type="1">
<li><h2 id="error-handling">Error Handling</h2></li>
</ol>
<p>Error handling is important because API consumers see the API as a
black box, and when an error occurs they need to know how to handle it.
Hence error responses need to be informative yet avoid information
leakage about the internals of the back-end system. Errors should be
handled in both a human- and machine-consumable way. When an error
occurs, the response body should contain:</p>
<ul>
<li><p>The HTTP status code</p></li>
<li><p>An API-specific error code, which API support staff will be able
to look up to identify what has gone wrong</p></li>
<li><p>A human readable error message (possibly including selective
technical details if the API is a development/test release for developer
consumption only)</p>
<ol type="1">
<li><h3 id="http-status-codes">HTTP Status Codes</h3></li>
</ol></li>
</ul>
<p>RESTful APIs should always use the standard HTTP error responses when
an error occurs, but different codes may be pertinent depending on the
HTTP verb being used and the quantity of data being retrieved (e.g.,
single item vs. list/collection of data).</p>
<p>The following tables give an example of good practice use of HTTP
error codes:</p>
<table>
<thead>
<tr class="header">
<th>GET Response Status Codes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Code</strong></td>
</tr>
<tr class="even">
<td>200</td>
</tr>
<tr class="odd">
<td>302</td>
</tr>
<tr class="even">
<td>304</td>
</tr>
<tr class="odd">
<td>401</td>
</tr>
<tr class="even">
<td>404</td>
</tr>
<tr class="odd">
<td>429</td>
</tr>
<tr class="even">
<td>500</td>
</tr>
<tr class="odd">
<td>503</td>
</tr>
<tr class="even">
<td><strong>POST or PUT Response Status Codes</strong></td>
</tr>
<tr class="odd">
<td><strong>Code</strong></td>
</tr>
<tr class="even">
<td>200</td>
</tr>
<tr class="odd">
<td>201</td>
</tr>
<tr class="even">
<td>400</td>
</tr>
<tr class="odd">
<td>401</td>
</tr>
<tr class="even">
<td>404</td>
</tr>
<tr class="odd">
<td>405</td>
</tr>
<tr class="even">
<td>429</td>
</tr>
<tr class="odd">
<td>500</td>
</tr>
<tr class="even">
<td><strong>DELETE Response Status Codes</strong></td>
</tr>
<tr class="odd">
<td><strong>Code</strong></td>
</tr>
<tr class="even">
<td>204</td>
</tr>
<tr class="odd">
<td>401</td>
</tr>
<tr class="even">
<td>404</td>
</tr>
<tr class="odd">
<td>405</td>
</tr>
<tr class="even">
<td>429</td>
</tr>
<tr class="odd">
<td>500</td>
</tr>
</tbody>
</table>
<p><em>Table 24: HTTP Status Codes</em> <em># 5</em></p>
<p>Where a consumer attempts to call a non-existent API end point,
respond with a <strong>501 Not Implemented</strong> status code.</p>
<pre><code>1.</code></pre>
<h3 id="api-specific-error-code">API-Specific Error Code</h3>
<p>Error responses need to supply enough information to allow the API
consumer to react appropriately to the error, yet not give away too
much. But when a critical error occurs it is important for the API
provider to be able to trace the root cause and fix it as soon as
possible.</p>
<p>One way of achieving this is to return an API-specific error code in
the response to consumer. When the consumer reports the error to the API
support team, the consumer can relate the associated API-specific code.
The support team can then look this code up and ascertain exactly what
has gone wrong and who needs to address it.</p>
<pre><code>1.</code></pre>
<h3 id="human-readable-error-message">Human-Readable Error Message</h3>
<p>The human readable error message should be as informative as is
useful to an end customer, without offering too many technical details
(e.g. “An account with this ID already exists”).</p>
<p>It is important to avoid revealing system information in the human
readable response, such as composition of the backend system
(e.g. component names), as this informs malicious consumers as to what
vulnerabilities and back doors to look for. It is also important not to
confirm or deny sensitive information, such as username in a
username/password combination, as this informs potential attackers which
criteria they have got correct. # 6</p>
<p>In non-production instances of the API it may be appropriate to offer
more verbose error messages with some technical detail (e.g. “Body
should be a JSON object”). However, it is still recommended not to
reveal too much about the internal systems which underpin the API, as
non-production systems still reflect a lot of the composition of
production.</p>
<p><strong>Example</strong></p>
<p>{</p>
<pre><code>&quot;errors&quot;: [

    {

        &quot;code&quot;: 12345,

        &quot;description&quot;: &quot;There has been an error - retrying the request will not succeed. Please contact support&quot;

    },

    {

        &quot;code&quot;: 98765,

        &quot;description&quot;: &quot;A more detailed description of the error if appropriate&quot;

    }

],

&quot;\_links&quot;: [

    {

        &quot;href&quot;: &quot;https://support.example.govt.nz&quot;,

        &quot;rel&quot;: &quot;support&quot;

    }

]</code></pre>
<p>}</p>
<ol type="1">
<li><h1 id="api-governance">API Governance</h1></li>
</ol>
<p>API governance helps save time and money because it ensures that APIs
are built proactively to achieve specific goals and bring value to the
Agency. API governance also helps Agencies make intelligent decisions
regarding API programs and establish best practices for building,
deploying, and consuming APIs.</p>
<p>API Governance should include:</p>
<ul>
<li>Specification and Resource Definitions – governing contracts and
resource definitions helps improve the consistency and reusability of
APIs;</li>
<li>Style and Pattern Guidelines – standardizing API design ensures APIs
remain consistent and improve usability;</li>
<li>Automation – establishing guardrails to make it easier to comply
with policies than not. For example, API scaffolding that automatically
generates security and audit componentry for APIs or build pipelines
that enforce security policies, such as coding standards and security
scans;</li>
<li>Lifecycle – governing the lifecycle of an API, from publication to
versioning and deprecation to retirement;</li>
<li>Tracking and Analytics – keeping track of where APIs are deployed,
who is using them and how they are being used. This information helps
inform other aspects of API governance.</li>
<li>A robust code review process. Ensuring that your development teams
understand the concepts laid out in this document and establishing a
practice where collaborative code reviews are performed. It is
recommended that software is developed using a branch strategy with at
least one peer review required prior to code merge and deployment.</li>
</ul>
<p>When your API designers and developers are on the same page regarding
APIs, the more efficient, valuable, and successful your API programs
will be. Governance is especially beneficial for Agencies that have a
large API program or microservices architectures.</p>
<p>For more information, refer to <a
href="https://nordicapis.com/api-governance-how-important-is-it-for-api-strategy/">https://nordicapis.com/api-governance-how-important-is-it-for-api-strategy/</a></p>
<ol type="1">
<li><h1 id="glossary-of-terms">Glossary of terms</h1></li>
</ol>
<p>Below is a list of common terms. Terms in the Description column
highlighted in bold are described elsewhere in the Glossary.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Analytics</td>
<td>Analytics in the context of this document is the capturing and
reporting of API usage.</td>
</tr>
<tr class="even">
<td>Consumers</td>
<td><strong>Customers</strong> , <strong>API Consuming
Applications</strong> and <strong>Application Developers</strong> who
use the <strong>API</strong>.</td>
</tr>
<tr class="odd">
<td>Consuming Application</td>
<td>This is any application (on any device) that consumes an
<strong>API</strong>.</td>
</tr>
<tr class="even">
<td>Context</td>
<td>Context in this document generally refers to request context. For
example, a <strong>JWT Token</strong> may contain information about the
customer initiating an API request.</td>
</tr>
<tr class="odd">
<td>Customers</td>
<td>People (or organisations) that use the <strong>Consuming
Applications</strong> to access the API resources the <strong>API
Provider</strong> is offering.</td>
</tr>
<tr class="even">
<td>Discovery</td>
<td>The ability for <strong>Application Developers</strong> to find
resources and associated APIs to use in their <strong>Consuming
Applications</strong></td>
</tr>
<tr class="odd">
<td>API</td>
<td>Application Programming Interface - a piece of software, which
provides a way for other disparate pieces of software (applications,
systems) to talk to one another.</td>
</tr>
<tr class="even">
<td>API Catalogue</td>
<td>The <strong>API</strong> delivery component that lists the
<strong>APIs</strong> offered, along with their
<strong>Interface</strong>** Specifications <strong>and guidance on how
to gain access and use the</strong> APIs**.</td>
</tr>
<tr class="odd">
<td>API Developer</td>
<td>The organisation (or person) who creates the <strong>API</strong>
and maintains the <strong>Interface Specification</strong> for the
<strong>API.</strong></td>
</tr>
<tr class="even">
<td>API Developer Portal</td>
<td>The <strong>API</strong> delivery component that allows <strong>API
Providers</strong> to engage with, onboard, educate and manage
<strong>Application Developers</strong> whether inside or outside the
organisation. These management activities will generally include
registration, documentation, analytics etc.</td>
</tr>
<tr class="odd">
<td>API Gateway</td>
<td>The <strong>API</strong> delivery component that allows <strong>API
Providers</strong> to offer <strong>APIs</strong> to the outside world.
This component (physical or virtual) hosts the APIs ready for
<strong>Consumers</strong> to access. It provides an <strong>API
Provider</strong> with the ability to control who has access to their
APIs by enforcing policies for access control. Some API gateways also
offer additional capabilities.</td>
</tr>
<tr class="even">
<td>API Manager</td>
<td>The <strong>API</strong> delivery component that allows <strong>API
Providers</strong> to control an <strong>API’s</strong> visibility and
behaviour. It is usually exposed as a UI/console to internal staff only,
as it is seen as an administration component. It offers a variety of
capabilities, including API registration and catalogue
administration.</td>
</tr>
<tr class="odd">
<td>API Provider</td>
<td>Organisation who provides the <strong>API</strong> to expose a
resource (information or functionality) for
<strong>Consumers</strong>.</td>
</tr>
<tr class="even">
<td>Application</td>
<td>The software behind the <strong>API</strong> which provides the
business logic for the resource.</td>
</tr>
<tr class="odd">
<td>Application Developer</td>
<td>Software developer or organisation who builds <strong>Consuming
Applications</strong> that use the <strong>API</strong>. An application
developer can be internal to your agency, developers that work with
trusted partners, developers from other agencies or developers from the
private sector.</td>
</tr>
<tr class="even">
<td>Interface Specification</td>
<td>Provides technical information to the <strong>API Developer</strong>
community about the <strong>API</strong>. It includes information about
how the <strong>API</strong> works, any access control features and any
error conditions.</td>
</tr>
<tr class="odd">
<td>Product Manager</td>
<td>The product manager is usually a technical role. They understand an
agencies API landscape and are owners of API management platforms.</td>
</tr>
<tr class="even">
<td>Product Owners</td>
<td>The product ownership function usually resides in a business area
rather than technology. The role of the product owner is to understand
the product that the agency is trying to deliver and be able to make
decisions on the representation of the product in an
<strong>API</strong>.</td>
</tr>
<tr class="odd">
<td>Publish</td>
<td>The act of releasing the interface specification and associated API
to a location accessible by <strong>Application Developers</strong></td>
</tr>
<tr class="even">
<td>Resource</td>
<td>The information or functionality exposed by the
<strong>API</strong>.</td>
</tr>
<tr class="odd">
<td>State</td>
<td>State defines the point in time record of an in-flight transaction.
Some systems maintain <em>user state</em> for a period of time to enable
a transaction to be continued from the point of last recorded state.
APIs are usually, but not always, considered stateless.</td>
</tr>
</tbody>
</table>
<p><em>Table 6: Glossary of terms</em></p>
<ol type="1">
<li><h1 id="glossary-of-acronyms">Glossary of acronyms</h1></li>
</ol>
<table>
<thead>
<tr class="header">
<th>Acronym</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AD</td>
<td>Active Directory</td>
</tr>
<tr class="even">
<td>API</td>
<td>Application Programming Interface</td>
</tr>
<tr class="odd">
<td>ASCII</td>
<td>American Standard Code for Information Interchange</td>
</tr>
<tr class="even">
<td>CA</td>
<td>Certificate Authority</td>
</tr>
<tr class="odd">
<td>CDN</td>
<td>Content Delivery Network</td>
</tr>
<tr class="even">
<td>DHE</td>
<td>Diffie-Hellman Ephemeral</td>
</tr>
<tr class="odd">
<td>DMZ</td>
<td>Demilitarized Zone</td>
</tr>
<tr class="even">
<td>DoS</td>
<td>Denial of Service</td>
</tr>
<tr class="odd">
<td>ECDHE</td>
<td>Elliptic Curve DHE</td>
</tr>
<tr class="even">
<td>HATEOAS</td>
<td>Hypermedia As The Engine Of Application State</td>
</tr>
<tr class="odd">
<td>HPP</td>
<td>HTTP Parameter Pollution</td>
</tr>
<tr class="even">
<td>HTTP</td>
<td>Hyper Text Transfer Protocol</td>
</tr>
<tr class="odd">
<td>IETF</td>
<td>Internet Engineering Task Force</td>
</tr>
<tr class="even">
<td>JSON</td>
<td>JavaScript Object Notation</td>
</tr>
<tr class="odd">
<td>JWA</td>
<td>JSON Web Algorithms</td>
</tr>
<tr class="even">
<td>JWE</td>
<td>JSON Web Encryption</td>
</tr>
<tr class="odd">
<td>JWK</td>
<td>JSON Web Key</td>
</tr>
<tr class="even">
<td>JWS</td>
<td>JSON Web Signature</td>
</tr>
<tr class="odd">
<td>JWT</td>
<td>JSON Web Token</td>
</tr>
<tr class="even">
<td>LDAP</td>
<td>Lightweight Directory Access Protocol</td>
</tr>
<tr class="odd">
<td>MAC</td>
<td>Message Authentication Code</td>
</tr>
<tr class="even">
<td>OWASP</td>
<td>Open Web Application Security Project</td>
</tr>
<tr class="odd">
<td>PBD</td>
<td>Primary Business Data</td>
</tr>
<tr class="even">
<td>RAML</td>
<td>Rest API Modelling Language</td>
</tr>
<tr class="odd">
<td>REST</td>
<td>Representative State Transfer</td>
</tr>
<tr class="even">
<td>RFC</td>
<td>Request for Comments (IETF)</td>
</tr>
<tr class="odd">
<td>RO</td>
<td>Resource Owner</td>
</tr>
<tr class="even">
<td>RS</td>
<td>Resource Server</td>
</tr>
<tr class="odd">
<td>SAML</td>
<td>Security Assertion Markup Language</td>
</tr>
<tr class="even">
<td>SCIM</td>
<td>System for Cross-domain Identity Management</td>
</tr>
<tr class="odd">
<td>SEO</td>
<td>Search Engine Optimization</td>
</tr>
<tr class="even">
<td>SLA</td>
<td>Service Level Agreement</td>
</tr>
<tr class="odd">
<td>SOAP</td>
<td>Simple Object Access Protocol</td>
</tr>
<tr class="even">
<td>SPML</td>
<td>Service Provisioning Markup Language</td>
</tr>
<tr class="odd">
<td>SQL</td>
<td>Structured Query Language</td>
</tr>
<tr class="even">
<td>SSO</td>
<td>Single Sign On</td>
</tr>
<tr class="odd">
<td>STS</td>
<td>Security Token Service</td>
</tr>
<tr class="even">
<td>TBC</td>
<td>To Be Completed</td>
</tr>
<tr class="odd">
<td>TBD</td>
<td>To Be Done</td>
</tr>
<tr class="even">
<td>TLS</td>
<td>Transport Layer Security (superseded SSL)</td>
</tr>
<tr class="odd">
<td>URL</td>
<td>Uniform Resource Locator</td>
</tr>
<tr class="even">
<td>URI</td>
<td>Uniform Resource Identifier</td>
</tr>
<tr class="odd">
<td>WSDL</td>
<td>Web Service Definition Language</td>
</tr>
<tr class="even">
<td>XSD</td>
<td>XML Schema Definition</td>
</tr>
<tr class="odd">
<td>WADL</td>
<td>Web API Description Language</td>
</tr>
<tr class="even">
<td>XACML</td>
<td>eXtensible Access Control Markup Language</td>
</tr>
<tr class="odd">
<td>XML</td>
<td>eXtensible Markup Language</td>
</tr>
<tr class="even">
<td>YAML</td>
<td>YAML Ain’t Markup Language</td>
</tr>
</tbody>
</table>
<p><em>Table 7: Glossary of acronyms</em></p>
<ol type="1">
<li><h1 id="further-reading">Further Reading</h1></li>
</ol>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>OWASP REST Security</th>
<th><a
href="https://www.owasp.org/index.php/REST_Security_Cheat_Sheet">https://www.owasp.org/index.php/REST_Security_Cheat_Sheet</a></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OWASP API Security Project</td>
<td><a
href="https://www.owasp.org/index.php/OWASP_API_Security_Project">https://www.owasp.org/index.php/OWASP_API_Security_Project</a></td>
</tr>
<tr class="even">
<td>OWASP Top Ten Project</td>
<td><a
href="https://owasp.org/www-project-top-ten/">https://owasp.org/www-project-top-ten/</a></td>
</tr>
<tr class="odd">
<td>OWASP Secure Coding Principles</td>
<td><a
href="https://www.owasp.org/index.php/Secure_Coding_Principles">https://www.owasp.org/index.php/Secure_Coding_Principles</a></td>
</tr>
<tr class="even">
<td>NZ Protective Security</td>
<td><a
href="https://www.protectivesecurity.govt.nz/">https://www.protectivesecurity.govt.nz/</a></td>
</tr>
<tr class="odd">
<td>Using HTTP Methods for RESTful Services</td>
<td><a
href="http://www.restapitutorial.com/lessons/httpmethods.html">http://www.restapitutorial.com/lessons/httpmethods.html</a></td>
</tr>
<tr class="even">
<td>Reserved JavaScript Keywords</td>
<td><a
href="http://www.w3schools.com/js/js_reserved.asp">http://www.w3schools.com/js/js_reserved.asp</a></td>
</tr>
<tr class="odd">
<td>REST API Resource Modelling</td>
<td><a
href="https://www.thoughtworks.com/insights/blog/rest-api-design-resource-modeling">https://www.thoughtworks.com/insights/blog/rest-api-design-resource-modeling</a></td>
</tr>
<tr class="even">
<td>Government ICT Strategy</td>
<td><a
href="https://www.ict.govt.nz/strategy-and-action-plan/strategy/">https://www.ict.govt.nz/strategy-and-action-plan/strategy/</a></td>
</tr>
<tr class="odd">
<td>OpenAPI Specification</td>
<td><a
href="https://github.com/OAI/OpenAPI-Specification">https://github.com/OAI/OpenAPI-Specification</a></td>
</tr>
<tr class="even">
<td>HTTP 1.1 Standards RFCs</td>
<td><a
href="https://tools.ietf.org/html/rfc7230">https://tools.ietf.org/html/rfc7230</a><a
href="https://tools.ietf.org/html/rfc7231">https://tools.ietf.org/html/rfc7231</a><a
href="https://tools.ietf.org/html/rfc7232">https://tools.ietf.org/html/rfc7232</a><a
href="https://tools.ietf.org/html/rfc7233">https://tools.ietf.org/html/rfc7233</a><a
href="https://tools.ietf.org/html/rfc7234">https://tools.ietf.org/html/rfc7234</a><a
href="https://tools.ietf.org/html/rfc7235">https://tools.ietf.org/html/rfc7235</a><a
href="https://tools.ietf.org/html/rfc7236">https://tools.ietf.org/html/rfc7236</a><a
href="https://tools.ietf.org/html/rfc7237">https://tools.ietf.org/html/rfc7237</a></td>
</tr>
</tbody>
</table>
<p><em>Table 11: Further Reading</em></p>
<ol type="1">
<li><h1 id="appendix-a-http-verbs">Appendix A – HTTP Verbs</h1></li>
</ol>
<p><strong>Required</strong></p>
<ol type="1">
<li><h2 id="get">GET</h2></li>
</ol>
<p>GET is used:</p>
<ul>
<li>For retrieval of information</li>
<li>If the interaction is more like a question (i.e. it is a safe
operation such as a query)</li>
</ul>
<p>The HTTP GET method is used to read (or retrieve) a representation of
a resource. It can be used to retrieve information about an individual
resource (e.g. customers/123456) or to retrieve a collection (list) of
resources (e.g. customers).</p>
<p>In the “happy” (non-error) path, GET returns a representation in JSON
and an HTTP response code of 200 (OK). In an error case, it most often
returns a 404 (NOT FOUND) or 400 (BAD REQUEST) if the requested resource
does not exist.</p>
<p>According to the HTTP specification, GET (along with HEAD) requests
are used only to read data and not change it. Therefore, they are
considered safe when used this way. That is, they can be called without
risk of data modification or corruption - calling it once has the same
effect as calling it 10 times. GET is idempotent, which means that
making multiple identical requests ends up having the same result as a
single request. Do not expose unsafe operations via GET - it should
never modify any resources on the server.</p>
<p><strong>Examples:</strong></p>
<p>GET https://api.example.govt.nz/passengers/12345</p>
<p>Accept: application/json,version=1.*</p>
<p>Accept-Encoding: gzip,deflate</p>
<p>Host: api.example.com</p>
<p>#Success Response</p>
<p>Content-Length: 612</p>
<p>Location: https://api.example.govt.nz/passengers/12345</p>
<p>Date: Fri Jul 08 16:52:21 NZST 2016</p>
<p>CorrelationID: 65347f577ade5f7750234abb</p>
<p>Transaction-Id: 65347f577bde5949ac7bd448</p>
<p>{</p>
<p>“id”: 12345</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>},</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: “home”,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111</p>
<p>},</p>
<p>{</p>
<p>“type”: “business”,</p>
<p>“address1”: “2 Work Street”,</p>
<p>“address2”: “Work Suburb”,</p>
<p>“address3”: “Work City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 2222</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>GET https://api.example.govt.nz/passengers/12345/flights</p>
<p>GET https://api.example.govt.nz/schools/98765/learners</p>
<p>Some API GET calls will return a single resource item whilst some
calls will return a collection of resource items. See <a
href="#_heading=h.261ztfg">section 2.7.6 Singletons vs. Collections</a>
for more details</p>
<ol type="1">
<li><h2 id="post">POST</h2></li>
</ol>
<p>POST is used:</p>
<ul>
<li>To create a piece of information or resource item</li>
<li>To spawn an action</li>
<li>If the interaction is like placing an order</li>
<li>If the interaction changes the state of the resource in a way that
the user would perceive (e.g. a subscription to a service)</li>
<li>If the user be held accountable for the results of the
interaction</li>
</ul>
<p>The POST verb is most-often utilized to create new resources. In
particular, it is used to create sub-resources: that is, subordinate to
some other (e.g. parent) resource. In other words, when creating a new
resource, POST to the parent and the API takes care of associating the
new resource with the parent, assigning an ID (new resource URI), etc.
On successful creation, POST returns an HTTP status 201, with a Location
header containing a link to the newly created resource.</p>
<p>POST is neither safe nor idempotent. It is therefore recommended for
non-idempotent resource requests. Making two identical POST requests
will most-likely result in two resources containing the same
information.</p>
<p>The body content of a POST request will differ to that of a PUT, as
the provider will create certain values such as a unique identifier for
the resource and its creation date.</p>
<p>In many cases a POST may have a small subset of the data that can
exist on a resource – a subsequent PUT to the resource can be performed
to populate the data.</p>
<p><strong>Examples:</strong></p>
<p>#Create a new passenger resource</p>
<p>POST https://api.example.govt.nz/passengers</p>
<p>{</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>},</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: “home”,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111</p>
<p>},</p>
<p>{</p>
<p>“type”: “business”,</p>
<p>“address1”: “2 Work Street”,</p>
<p>“address2”: “Work Suburb”,</p>
<p>“address3”: “Work City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 2222</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>#Successful resource creation response</p>
<p>HTTP/1.1 201 Created</p>
<p>Location: https://api.example.govt.nz/passengers/12345</p>
<p>Content-Location: https://api.example.govt.nz/passengers/12345</p>
<p>Content-Type: application/json</p>
<p>{</p>
<p>“id”: 12345,</p>
<p>“names”: {</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>},</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: “home”,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111</p>
<p>},</p>
<p>{</p>
<p>“type”: “business”,</p>
<p>“address1”: “2 Work Street”,</p>
<p>“address2”: “Work Suburb”,</p>
<p>“address3”: “Work City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 2222</p>
<p>}</p>
<p>]</p>
<p>}</p>
<ol type="1">
<li><h2 id="put">PUT</h2></li>
</ol>
<p>PUT is used:</p>
<ul>
<li>To update an existing resource item</li>
<li>To replace an existing resource item</li>
</ul>
<p>PUT is most-often utilized to update information, PUT-ing to a known
resource URI with the request body containing the newly updated
representation of the original resource.</p>
<p>However, PUT can also be used to create a resource in the case where
the resource ID is chosen by the consumer instead of by the API itself:
where PUT is to a URI that contains the value of a non-existent resource
ID. Again, the request body contains a resource representation. This
method of creation should be avoided if possible, or used sparingly. If
consumer-defined resource IDs are required, use POST to create the new
resource and provide the consumer-defined ID in the body representation
(see POST).</p>
<p>On a successful update, PUT returns 200 (or 204 if not returning any
content in the body). If using PUT to create, return HTTP status 201 on
successful creation. A body in the response is optional. It is not
necessary to return a link via a Location header in the creation case
since the consumer already knows the resource ID, having set it
themselves.</p>
<p>PUT is not a safe operation: it modifies (or creates) state on the
server, but it is idempotent. I.e. if you create or update a resource
using PUT and then make that same call again, the resource is still
there and still has the same state as it did with the first call.
However, were the PUT call to increment a counter within the resource,
the call is no longer idempotent. Sometimes this is necessary behaviour,
and it may be enough to document that the call is not idempotent.
However, it’s recommended to keep PUT requests idempotent. It is
strongly recommended to use POST for non-idempotent requests.</p>
<p>It is good practice to perform a GET on a resource before you perform
a PUT. This means that the consuming application has the latest
representation of that resource. PUT should contain the entire resource
content in the message body. By performing a GET prior to the PUT the
consuming application can re-send the results of the GET with any
modifications.</p>
<p>When using a resource response cache, any PUT to a resource should
invalidate that cache or re-populate the cache with the updated
resource.</p>
<p><strong>Examples:</strong></p>
<h1 id="get-a-resource">Get a resource</h1>
<p>GET https://api.example.govt.nz/passengers/12345/1w3r4y6u</p>
<h1
id="the-response-can-be-cached-in-a-response-cache-with-a-cache-key-of-the-resource-e.g.-cachekey__12345_1w3r4y6u">The
response can be cached in a response cache with a cache key of the
resource e.g. cachekey__12345_1w3r4y6u</h1>
<h1 id="response-body">Response Body</h1>
<p>{</p>
<p>“id”: “1w3r4y6u”,</p>
<p>“passenger_name”: “SMITH/NICOLAS”,</p>
<p>“pnr_number”: “CG4X7U”,</p>
<p>“travel_class”: “business”,</p>
<p>“seat”: “74J”,</p>
<p>“auxiliary_fields”: [</p>
<p>{</p>
<p>“label”: “Terminal”,</p>
<p>“value”: “T1”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Departure”,</p>
<p>“value”: “30OCT 19:05”</p>
<p>}</p>
<p>],</p>
<p>“secondary_fields”: [</p>
<p>{</p>
<p>“label”: “Boarding”,</p>
<p>“value”: “18:30”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Gate”,</p>
<p>“value”: “D57”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Seat”,</p>
<p>“value”: “74J”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Sec.Nr.”,</p>
<p>“value”: “003”</p>
<p>}</p>
<p>],</p>
<p>“flight_info”: {</p>
<p>“flight_number”: “KL0642”,</p>
<p>“departure_airport”: {</p>
<p>“airport_code”: “JFK”,</p>
<p>“city”: “New York”,</p>
<p>“terminal”: “T1”,</p>
<p>“gate”: “D57”</p>
<p>},</p>
<p>“arrival_airport”: {</p>
<p>“airport_code”: “AMS”,</p>
<p>“city”: “Amsterdam”</p>
<p>},</p>
<p>“flight_schedule”: {</p>
<p>“departure_time”: “2016-01-02T19:05”,</p>
<p>“arrival_time”: “2016-01-05T17:30”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<h1 id="put-to-a-resource-update-changing-the-seat-number">Put to a
resource (update) changing the seat number</h1>
<p>PUT https://api.example.govt.nz/passengers/12345/flights/1w3r4y6u</p>
<p>#The api invalidates cache object with key
cachekey__12345_1w3r4y6u</p>
<p>{</p>
<p>“id”: “1w3r4y6u”,</p>
<p>“passenger_name”: “SMITH/NICOLAS”,</p>
<p>“pnr_number”: “CG4X7U”,</p>
<p>“travel_class”: “business”,</p>
<p>“seat”: “10J”,</p>
<p>“auxiliary_fields”: [</p>
<p>{</p>
<p>“label”: “Terminal”,</p>
<p>“value”: “T2”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Departure”,</p>
<p>“value”: “30OCT 19:05”</p>
<p>}</p>
<p>],</p>
<p>“secondary_fields”: [</p>
<p>{</p>
<p>“label”: “Boarding”,</p>
<p>“value”: “18:30”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Gate”,</p>
<p>“value”: “D57”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Seat”,</p>
<p>“value”: “10J”</p>
<p>},</p>
<p>{</p>
<p>“label”: “Sec.Nr.”,</p>
<p>“value”: “003”</p>
<p>}</p>
<p>],</p>
<p>“flight_info”: {</p>
<p>“flight_number”: “KL0642”,</p>
<p>“departure_airport”: {</p>
<p>“airport_code”: “JFK”,</p>
<p>“city”: “New York”,</p>
<p>“terminal”: “T1”,</p>
<p>“gate”: “D57”</p>
<p>},</p>
<p>“arrival_airport”: {</p>
<p>“airport_code”: “AMS”,</p>
<p>“city”: “Amsterdam”</p>
<p>},</p>
<p>“flight_schedule”: {</p>
<p>“departure_time”: “2016-01-02T19:05”,</p>
<p>“arrival_time”: “2016-01-05T17:30”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<h1 id="response-that-update-was-successful">Response that update was
successful</h1>
<p>HTTP/1.1 204 No Content</p>
<p>Content-Location: /passengers/12345/flights/1w3r4y6u</p>
<ol type="1">
<li><h2 id="delete">DELETE</h2></li>
</ol>
<p>DELETE is used:</p>
<ul>
<li>To delete a resource item</li>
</ul>
<p>DELETE is only used to delete a resource identified by a URI.</p>
<p>On successful deletion, DELETE returns an HTTP status 200 (OK) along
with a response body, and optionally the representation of the deleted
item, or a wrapped response. Alternatively, DELETE can return HTTP
status 204 (NO CONTENT) with no response body.</p>
<p>DELETE operations are idempotent. If you DELETE a resource, it is
removed. Repeatedly calling DELETE on that resource ends up as the same
result: the resource is gone. However, calling DELETE on a resource a
second time will often return a 404 (NOT FOUND) since it was already
removed and therefore is no longer findable. This, in some opinion,
makes DELETE operations no longer idempotent, but the end-state of the
resource is the same. Returning a 404 is acceptable and communicates
accurately the status of the call. If calling DELETE were to decrement a
counter (within the resource), the DELETE call is no longer
idempotent.</p>
<p><strong>Example:</strong></p>
<p>#Delete a resource</p>
<p>DELETE
https://api.example.govt.nz/passengers/12345/flights/1w3r4y6u</p>
<p>#Response</p>
<p>HTTP/1.1 204 No Content</p>
<p>Content-Location: /passengers/12345/flights/1w3r4y6u</p>
<ol type="1">
<li><h2 id="options">OPTIONS</h2></li>
</ol>
<p>OPTIONS is used to retrieve information about what the consumer is
allowed to do with the Resource</p>
<ol type="1">
<li><h2 id="other">Other</h2></li>
</ol>
<p>PATCH is a valid HTTP verb, but is still in draft and its use is
discouraged due to complexity. An exception to this might be where an
agency adopted standard, such as FHIR <a
href="https://www.hl7.org/fhir/http.html#patch">https://www.hl7.org/fhir/http.html#patch</a>,
supports the use of PATCH.</p>
<p>HEAD is used to retrieve metadata about a resource, such as when it
was last updated or the associated response headers. The response to a
HEAD request MUST NOT contain a body. If a response body is returned it
MUST be ignored.</p>
<ol type="1">
<li><h1 id="appendix-b-http-headers">Appendix B – HTTP Headers</h1></li>
</ol>
<p><strong>Required</strong></p>
<ol type="1">
<li><h2 id="request-headers-1">Request Headers</h2></li>
</ol>
<p>Request headers are supplied by the consuming application and must
include the following elements:</p>
<ul>
<li>Accept</li>
<li>Content-Type</li>
<li>Authorization</li>
</ul>
<p>Header definitions can be found in <a
href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">RFC2616</a></p>
<pre><code>1.</code></pre>
<h3 id="accept">Accept</h3>
<p><strong>Required</strong></p>
<p>An Accept header is required to indicate what format the consuming
application wants the information to be returned as (e.g. JSON or XML).
It is preferable for the consuming application to specify the response
content type that they expect, however it is acceptable to use the
<em>‘q’</em> parameter to specify the quality of support.</p>
<p><strong>Examples</strong></p>
<p>#Accept JSON and latest version</p>
<p>Accept: application/json,version=*</p>
<p>#Prefer JSON, Accept XML and latest version 1 release</p>
<p>Accept: application/json;q=1.0,application/xml;q=0.8,version=1.*</p>
<p>#Accept XML only and version 1.2 only</p>
<p>Accept: application/xml;q=1.0,application/json;q=0.0,version=1.2</p>
<p>If the client has specified via the Accept header that it doesn’t
support any formats provided by the API, the server should return an
HTTP 406 Not Acceptable response. The response should also include a
Link header with a link to documentation or help on supported formats.
The body of the representation should include an error message in human
readable plain text or HTML.</p>
<p><strong>Example Response</strong></p>
<h1
id="response-that-indicates-the-request-failed-due-to-the-client-not">Response
that indicates the request failed due to the client not</h1>
<h1 id="supporting-any-response-formats-provided-by-the-api">supporting
any response formats provided by the API</h1>
<p>HTTP/1.1 406 Not Acceptable</p>
<p>Content-Type: text/plain</p>
<p>This API does not support any of the requested content types
specified in the HTTP Accept header. Please see
http://www.example.com/api/documentation/widgetservice for details on
the supported content types.</p>
<p>The Accept header is required, however the <em>‘version’</em> and
<em>‘q’</em> are recommended as this will depend on a provider’s
implementation and in some cases technology choice.</p>
<pre><code>1.</code></pre>
<h3 id="content-type">Content-Type</h3>
<p><strong>Required</strong></p>
<p>The Content-Type header is required for all requests that include a
request body i.e. POST, PUT, DELETE.</p>
<p><strong>Example</strong></p>
<p>#PUT https://api.example.govt.nz/v2/learners/33245</p>
<p>Accept: application/json,version=1.*</p>
<p>Content-Type: application/json</p>
<p>Authorization: Bearer x6TLB4JaomezC5rJ3CIl3KxxNinq</p>
<p>{</p>
<p>“id”: “33245”,</p>
<p>“names”:</p>
<p>{</p>
<p>“firstName”: “John”,</p>
<p>“middleName”: “Howard”,</p>
<p>“lastName”: “Doe”,</p>
<p>“salutation”: “Mr John Doe”,</p>
<p>“title”: “Mr”</p>
<p>},</p>
<p>“addresses”: [</p>
<p>{</p>
<p>“type”: “home”,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111</p>
<p>},</p>
<p>{</p>
<p>“type”: “business”,</p>
<p>“address1”: “2 Work Street”,</p>
<p>“address2”: “Work Suburb”,</p>
<p>“address3”: “Work City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 2222</p>
<p>}</p>
<p>],</p>
<p>“qualifications”:[</p>
<p>{</p>
<p>“id”: “1a4rf54ee345”,</p>
<p>“type”: “Some type”,</p>
<p>“provider”: “University of life”,</p>
<p>“providerId”: “0o9i8u7y6tt”</p>
<p>},</p>
<p>{</p>
<p>“id”: “8u7y6t5r4ee”,</p>
<p>“type”: “Another type”,</p>
<p>“provider”: “School xyz”,</p>
<p>“providerId”: “1q2w3e4r5tt”</p>
<p>}</p>
<p>]</p>
<p>}</p>
<pre><code>1.</code></pre>
<h3 id="authorization">Authorization</h3>
<p><strong>Required</strong></p>
<p>Most API requests will be authorised. The Authorization header should
be used for this purpose and no other. Note that the Authorization
header is not the best place for an API Key.</p>
<p>The Authorization header is comprised of a type and a token depending
on the authorization type.</p>
<p><strong>Example</strong></p>
<p>#OAuth Access Token</p>
<p>Authorization: Bearer x6TLB4JaomezC5rJ3CIl3KxxNinq</p>
<p>#HTTP Basic</p>
<p>Authorization: Basic c29tZXVzZXI6c29tZSBwYXNzd29yZA==</p>
<pre><code>1.</code></pre>
<h3 id="accept-encoding">Accept-Encoding</h3>
<p><strong>Recommended</strong></p>
<p>In some cases, especially where API responses are very large, it may
be worth compressing HTTP responses. (Note: where possible it is best to
avoid large payloads in API responses; however, this may not always be
possible.) An Accept-Encoding value of gzip instructs a provider that
supports HTTP compression that the consuming application supports
compressed responses.</p>
<p><strong>Example</strong></p>
<p>Accept-Encoding: gzip,deflate</p>
<pre><code>1.</code></pre>
<h3 id="api-key-header">API Key Header</h3>
<p><strong>Required</strong></p>
<p>An API key issued to a consuming application should be sent with
every request made to the API. The name of the header is up to the
agency, but it should not be an X- prefixed header as this use is
deprecated (see 2.5.3). Sometimes API keys are passed in URIs; however,
this is not considered best practice and should be avoided.</p>
<p><strong>Example</strong></p>
<p>KeyID: pX680LyiKasUBWLuZJ8AVBHVQK03Ghtr</p>
<pre><code>1.</code></pre>
<h3
id="if-modified-sinceif-none-match">If-Modified-Since/If-None-Match</h3>
<p><strong>Recommended</strong></p>
<p>The If-Modified header is a pre-condition header used to instruct a
client on the validity of the resource requested. Note that
pre-condition handling is not required, but where appropriate should be
considered. Pre-condition control can be a complex topic so in some
cases the complexity may eclipse the value.</p>
<p>Conditional header standards are available in <a
href="https://tools.ietf.org/html/rfc7232">Hypertext Transfer Protocol
(HTTP/1.1): Conditional Requests RFC7232</a>.</p>
<p>A consuming application can specify an If-Modified-Since header with
a date and time. The server checks the resource to see the last modified
time. If the last modification was before the date/time specified in the
header, the server will respond with an HTTP 304 status code telling the
consuming application that the resource they requested has not changed
and therefore there is no need to return the full payload in the
response.</p>
<p>When using If-Modified headers you should also implement ETag as
discussed in the <a href="#_heading=h.20xfydz">headers section
(2.6)</a>.</p>
<p><strong>Example</strong></p>
<h1
id="request-with-if-modified-since-and-if-none-match-headers">Request
with If-Modified-Since and If-None-Match headers</h1>
<p>If-Modified-Since: Wed, 18 Jun 2016 22:00:00 GMT</p>
<p>If-None-Match: “686897696a7c876b7e”</p>
<p>The If-None-Match header indicates to the provider the ETag for the
resource that it currently holds for that resource.</p>
<p><strong>Example Response</strong></p>
<h1
id="response-that-indicates-the-clients-current-representation-is-still">Response
that indicates the client’s current representation is still</h1>
<h1 id="valid">valid</h1>
<p>HTTP/1.1 304 Not Modified</p>
<p>ETag: “686897696a7c876b7e”</p>
<p>Content-Length: 0</p>
<pre><code>1.</code></pre>
<h3 id="request-tracking-headers">Request tracking headers</h3>
<p><strong>Recommended</strong></p>
<p>To support the tracking of API requests it is a good idea to apply a
transaction ID header that will enable analysts to trace a request
throughout its lifecycle. Note: there is no set naming standard for a
transaction ID header.</p>
<p>There are two common approaches to this: one is to request that the
consuming application generate a unique transaction ID and the provider
will capture it and respond with a corresponding correlation ID; the
second is to allow the provider to generate the transaction ID as close
to the edge of its domain as possible, and respond to the consuming
application with that transaction ID. In this case a consuming
application administrator or developer should capture and log that
transaction ID for audit purposes so that it can be relayed to agency
analysts if required.</p>
<p><strong>Example Request</strong></p>
<p>#Request that includes a consuming application generated
transaction</p>
<p>#ID</p>
<p>Request-Transaction-Id: c188cb0e-1a09-4184-890c-0f0bb2255425</p>
<p><strong>Example Response</strong></p>
<p>#Response to a consuming application that provided a client generated
#transaction ID</p>
<p>Request-Transaction-Id: c188cb0e-1a09-4184-890c-0f0bb2255425</p>
<p>Response-Correlation-Id: 514dbf50-4475-4e4d-86ee-e2001f158026</p>
<p>#Response to a consuming application where there was no client
#generated transaction ID</p>
<p>#Note that the server has generated the transaction ID</p>
<p>Response-Correlation-Id: c188cb0e-1a09-4184-890c-0f0bb2255425</p>
<ol type="1">
<li><h2 id="response-headers-1">Response Headers</h2></li>
</ol>
<p>Response headers are supplied by the provider and must contain
Content-Type.</p>
<pre><code>1.</code></pre>
<h3 id="content-type-1">Content-Type</h3>
<p><strong>Required</strong></p>
<p>The Content-Type must be returned in the response, and indicate the
format type the response content is in e.g.Content-Type:
application/json. The Content-Type header should also include the
version of the API that processed the request e.g.Content-Type:
application/json,version=1.1</p>
<pre><code>1.</code></pre>
<h3 id="location">Location</h3>
<p><strong>Recommended</strong></p>
<p>Where a new resource item has been created (POST), the server should
respond with a 201 Created HTTP header and a Location header indicating
the URI of the newly created resource item e.g.Location:
https://api.example.govt.nz/v1/crown-property/198373</p>
<p>A location header should also be returned by a server when it sends a
3** HTTP response, indicating a temporary or permanent redirection.</p>
<p>A location header can be, as recommended by this standard, absolute
e.g. Location: https://api.example.govt.nz/v1/crown-property/198373 or
relative e.g. Location: /v1/crown-property/198373</p>
<pre><code>1.</code></pre>
<h3 id="content-location">Content-Location</h3>
<p><strong>Recommended</strong></p>
<p>The Content-Location header indicates the location of the requested
resource. It should be an absolute and not a relative link.</p>
<p><strong>Example</strong></p>
<p>#GET https://api.example.govt.nz/v1/crown-property/198373</p>
<p>Content-Type: application/json</p>
<p>Content-Location:
https://api.example.govt.nz/v1/crown-property/198373</p>
<p>{</p>
<p>“propertyid”: 12345,</p>
<p>“address1”: “1 Some Street”,</p>
<p>“address2”: “Some Suburb”,</p>
<p>“address3”: “Some City”,</p>
<p>“address4”: null,</p>
<p>“country”: “New Zealand”,</p>
<p>“postcode”: 1111,</p>
<p>“type”: “commercial”</p>
<p>}</p>
<pre><code>1.</code></pre>
<h3 id="cache-control">Cache-Control</h3>
<p><strong>Recommended</strong></p>
<p>It is important to consider caching when designing APIs, to ensure
that the APIs you build can perform at scale. The Cache-Control header
is only concerned with caching that occurs externally to the API layer.
Common examples may be client-side caching or caching within a Content
Delivery Network (CDN). This header should not be concerned with caching
mechanisms within the API layer such as response caches or object
caches, which require a different caching strategy.</p>
<p>The Cache-Control header is comprised of the following:</p>
<ul>
<li><strong>private|public</strong> : This indicates if the cache is
specific to the consumer or not – a setting of private will prevent the
cache from being persisted in a public cache.</li>
<li><strong>no-cache:</strong> This instructs a cache to revalidate the
resource every time <strong>.</strong></li>
<li><strong>no-store:</strong> This instructs a cache not to store the
response. It also ensures that no part of the request is stored
too.</li>
<li><strong>max-age:</strong> This instructs the cache on expiry time.
This can be used but it makes more sense to use the Expires header
discussed below.</li>
<li><strong>s-max-age:</strong> Similar to the above, however it refers
to a shared cache hence only relevant to CDNs and other intermediary
caches.</li>
<li><strong>must-revalidate:</strong> This instructs the client to
resend request headers and receive confirmation that the resource has
not changed.</li>
<li><strong>proxy-revalidate:</strong> Similar to the above, however
specific to shared caches.</li>
</ul>
<p><strong>Example</strong></p>
<h1 id="example-caching-response">Example caching response</h1>
<p>HTTP/1.1 200 OK</p>
<p>Date: Wed, 06 Jul 2016 21:14:52 GMT</p>
<p>Expires: Wed, 06 Jul 2016 22:14:52 GMT</p>
<p>Cache-Control: private,max-age=14400,must-revalidate</p>
<p>Content-Type: application/json</p>
<p>Care should be taken when using caches, especially shared or public
caches. In some cases it may be more prudent to use the no-cache
directive to ensure that content is not cached outside your network.
This does not rule out caching within your API layer. For more
information on API caching please see <a
href="#_heading=h.2pta16n">section 2.12</a>.</p>
<p>HTTP Cache Control standards can be found in <a
href="https://tools.ietf.org/html/rfc7234">Hypertext Transfer Protocol
(HTTP/1.1): Caching RFC7234</a> # 7</p>
<pre><code>1.</code></pre>
<h3 id="expires">Expires</h3>
<p><strong>Recommended</strong></p>
<p>When using Cache-Control you should include an Expires header in the
response for backward compatibility.</p>
<pre><code>1.</code></pre>
<h3 id="etag-entity-tag">ETag (Entity Tag)</h3>
<p><strong>Recommended</strong></p>
<p>The ETag header is a concurrency control header, and when in a
response it is a tag that the consuming application can use when making
a subsequent request to a resource. Note that pre-condition handling is
not required, but where appropriate should be considered. Pre-condition
control can be a complex topic so in some cases the complexity may
eclipse the value.</p>
<h1 id="response-with-etag-header">Response with ETag Header</h1>
<h1
id="consuming-application-would-send-this-etag-in-an-if-none-match-request-header">Consuming
application would send this ETag in an If-None-Match #request
header</h1>
<p>ETag: “686897696a7c876b7e”</p>
<ol type="1">
<li><h2 id="custom-x--http-headers">Custom X- HTTP Headers</h2></li>
</ol>
<p>X- notation headers have been deprecated as per <a
href="https://tools.ietf.org/html/rfc6648">RFC6648</a> # 8 and should
not be used. This is because the X- name often became a standard, making
the X-notation inaccurate (e.g. x-gzip became gzip) and requiring
support for both the X- and the non-X- notation. Common uses of the X-
headers are examples such as the X-HTTP-Method-Override header or the
X-Forwarded-For header.</p>
<p>Where an agency feels that a custom HTTP header is required that is
not available within the current HTTP standard they can use a custom
header without the X- prefix.</p>
<ol type="1">
<li><h1 id="appendix-c-example-interface-specification">Appendix C –
Example Interface Specification</h1></li>
</ol>
<p>The following illustrates a sample API Interface Specification. The
specification is written in Swagger and visualised here (for
readability) via a Confluence plugin however most API Developer Portal
products will support importing OpenAPI specifications.</p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_4ecf70ccccfce3e.png" /></p>
<p><em>Figure 52: Example Agency API – delete customer</em></p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_c774dfdaa5f85a5f.png" /></p>
<p><em>Figure 53: Example Agency API – get customer details</em></p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_f316939a6ad77e67.png" /></p>
<p><em>Figure 54: Example Agency API – modify customer</em></p>
<p><img
src="RackMultipart20230926-1-dmx0qn_html_d2f78d2f52a7a08a.png" /></p>
<p><em>Figure 55: Example Agency API – create customer</em></p>
<p>The raw JSON and YAML is below. This is best viewed via the Swagger
editor <a
href="http://editor.swagger.io/#/">http://editor.swagger.io/#/</a></p>
<p>To view, simply open the OpenAPI editor as above and paste the
contents of the JSON or YAML examples into the editor window.</p>
<p><strong>JSON</strong></p>
<p>{</p>
<p>“swagger”: “2.0”,</p>
<p>“info”: {</p>
<p>“version”: “2.0.0”,</p>
<p>“title”: “Example Agency API”,</p>
<p>“description”: “A sample API specification demonstrating OpenAPI
capabilities - this is for example purposes only”,</p>
<p>“termsOfService”:
“https://developer.example.govt.nz/termsandconditions/”,</p>
<p>“contact”: {</p>
<p>“name”: “Example Agency API team”,</p>
<p>“email”: “exampleteam@api.govt.nz”,</p>
<p>“url”: “https://agency.govt.nz”</p>
<p>}</p>
<p>},</p>
<p>“host”: “api.example.govt.nz”,</p>
<p>“basePath”: “/v2”,</p>
<p>“paths”: {</p>
<p>“/customers/{customerId}”: {</p>
<p>“get”: {</p>
<p>“parameters”: [</p>
<p>{</p>
<p>“name”: “customerId”,</p>
<p>“in”: “path”,</p>
<p>“description”: “Unique ID of customer”,</p>
<p>“required”: true,</p>
<p>“type”: “string”</p>
<p>}</p>
<p>],</p>
<p>“tags”: [</p>
<p>“get customer details”</p>
<p>],</p>
<p>“description”: “Returns details for a customer given a unique
customer ID”,</p>
<p>“security”: [</p>
<p>{</p>
<p>“AuthorizationCode”: [</p>
<p>“customerRead”</p>
<p>]</p>
<p>}</p>
<p>],</p>
<p>“produces”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“responses”: {</p>
<p>“200”: {</p>
<p>“description”: “OK - Successful”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/customerDetailsResponse”</p>
<p>}</p>
<p>},</p>
<p>“default”: {</p>
<p>“description”: “Error response”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/errorModel”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“put”: {</p>
<p>“tags”: [</p>
<p>“modify customer”</p>
<p>],</p>
<p>“description”: “Updates a customer’s details”,</p>
<p>“consumes”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“produces”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“parameters”: [</p>
<p>{</p>
<p>“name”: “customerId”,</p>
<p>“in”: “path”,</p>
<p>“description”: “Unique ID of customer”,</p>
<p>“required”: true,</p>
<p>“type”: “string”</p>
<p>},</p>
<p>{</p>
<p>“name”: “body”,</p>
<p>“in”: “body”,</p>
<p>“required”: true,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/customerRequestModel”</p>
<p>}</p>
<p>}</p>
<p>],</p>
<p>“responses”: {</p>
<p>“200”: {</p>
<p>“description”: “Updated resource successfully”</p>
<p>},</p>
<p>“default”: {</p>
<p>“description”: “Error response”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/errorModel”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“security”: [</p>
<p>{</p>
<p>“AuthorizationCode”: [</p>
<p>“customerWrite”</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>},</p>
<p>“delete”: {</p>
<p>“tags”: [</p>
<p>“delete customer”</p>
<p>],</p>
<p>“description”: “Deletes an existing customer resource”,</p>
<p>“consumes”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“produces”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“parameters”: [</p>
<p>{</p>
<p>“name”: “customerId”,</p>
<p>“in”: “path”,</p>
<p>“description”: “Unique ID of customer”,</p>
<p>“required”: true,</p>
<p>“type”: “string”</p>
<p>}</p>
<p>],</p>
<p>“responses”: {</p>
<p>“200”: {</p>
<p>“description”: “Deleted resource successfully”</p>
<p>},</p>
<p>“default”: {</p>
<p>“description”: “Error response”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/errorModel”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“security”: [</p>
<p>{</p>
<p>“AuthorizationCode”: [</p>
<p>“customerDelete”</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>},</p>
<p>“/customers”: {</p>
<p>“post”: {</p>
<p>“tags”: [</p>
<p>“create customer”</p>
<p>],</p>
<p>“description”: “Creates a new customer. API will create a customer
resource and, if successful, return a hyperlink to the created
resource”,</p>
<p>“consumes”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“produces”: [</p>
<p>“application/json”</p>
<p>],</p>
<p>“parameters”: [</p>
<p>{</p>
<p>“name”: “body”,</p>
<p>“in”: “body”,</p>
<p>“required”: true,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/customerRequestModel”</p>
<p>}</p>
<p>}</p>
<p>],</p>
<p>“responses”: {</p>
<p>“201”: {</p>
<p>“description”: “Created resource successfully”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/_links”</p>
<p>}</p>
<p>},</p>
<p>“default”: {</p>
<p>“description”: “Error response”,</p>
<p>“schema”: {</p>
<p>“$ref”: “#/definitions/errorModel”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“security”: [</p>
<p>{</p>
<p>“AuthorizationCode”: [</p>
<p>“customerCreate”</p>
<p>]</p>
<p>}</p>
<p>]</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“securityDefinitions”: {</p>
<p>“AuthorizationCode”: {</p>
<p>“type”: “oauth2”,</p>
<p>“scopes”: {</p>
<p>“customerRead”: “Grants read access to a customer resource”,</p>
<p>“customerWrite”: “Grants write (update) access to an existing
customer resource”,</p>
<p>“customerCreate”: “Grants access to create a new customer
resource”,</p>
<p>“customerDelete”: “Grants access to delete an existing customer
resource”</p>
<p>},</p>
<p>“flow”: “accessCode”,</p>
<p>“authorizationUrl”:
“https://idm.example.govt.nz/oauth/authorize”,</p>
<p>“tokenUrl”: “https://idm.example.govt.nz/oauth/access_token”</p>
<p>}</p>
<p>},</p>
<p>“definitions”: {</p>
<p>“customerRequestModel”: {</p>
<p>“type”: “object”,</p>
<p>“properties”: {</p>
<p>“names”: {</p>
<p>“type”: “object”,</p>
<p>“properties”: {</p>
<p>“firstName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers first name”</p>
<p>},</p>
<p>“middleName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers middle name”</p>
<p>},</p>
<p>“lastName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers last name”</p>
<p>},</p>
<p>“salutation”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers salutation - e.g. Mr John Doe”</p>
<p>},</p>
<p>“title”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers title - e.g. Ms, Mr, Mrs, Dr etc.”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“addresses”: {</p>
<p>“type”: “array”,</p>
<p>“description”: “An array of addresses. Unpopulated properties or
items will be returned as null JSON objects.”,</p>
<p>“items”: {</p>
<p>“properties”: {</p>
<p>“addressType”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Address type - e.g. Home, Business”</p>
<p>},</p>
<p>“address1”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “First line of the address e.g. 2 something
street”</p>
<p>},</p>
<p>“address2”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Second line of address e.g. Khandallah”</p>
<p>},</p>
<p>“address3”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Third line of address e.g. Wellington”</p>
<p>},</p>
<p>“address4”: {</p>
<p>“type”: “string”</p>
<p>},</p>
<p>“country”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “This is a human readable country name e.g. New
Zealand and not a country code”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“customerDetailsResponse”: {</p>
<p>“type”: “object”,</p>
<p>“required”: [</p>
<p>“customerId”</p>
<p>],</p>
<p>“properties”: {</p>
<p>“customerId”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Unique identifier for the customer resource - GUID
format”</p>
<p>},</p>
<p>“names”: {</p>
<p>“type”: “object”,</p>
<p>“properties”: {</p>
<p>“firstName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers first name”</p>
<p>},</p>
<p>“middleName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers middle name”</p>
<p>},</p>
<p>“lastName”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers last name”</p>
<p>},</p>
<p>“salutation”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers salutation - e.g. Mr John Doe”</p>
<p>},</p>
<p>“title”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Customers title - e.g. Ms, Mr, Mrs, Dr etc.”</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“addresses”: {</p>
<p>“type”: “array”,</p>
<p>“description”: “An array of addresses. Unpopulated properties or
items will be returned as null JSON objects.”,</p>
<p>“items”: {</p>
<p>“properties”: {</p>
<p>“addressType”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Address type - e.g. Home, Business”</p>
<p>},</p>
<p>“address1”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “First line of the address e.g. 2 something
street”</p>
<p>},</p>
<p>“address2”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Second line of address e.g. Khandallah”</p>
<p>},</p>
<p>“address3”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “Third line of address e.g. Wellington”</p>
<p>},</p>
<p>“address4”: {</p>
<p>“type”: “string”</p>
<p>},</p>
<p>“country”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “This is a human readable country name e.g. New
Zealand and not a country code”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“_links”: {</p>
<p>“type”: “array”,</p>
<p>“description”: “An array of related links relevant to the
request/response.”,</p>
<p>“items”: {</p>
<p>“properties”: {</p>
<p>“rel”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “A piece of information providing context for the link
- e.g. self or accounts.”</p>
<p>},</p>
<p>“href”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “A fully qualified URL to the resource.”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“errorModel”: {</p>
<p>“type”: “object”,</p>
<p>“properties”: {</p>
<p>“errors”: {</p>
<p>“type”: “array”,</p>
<p>“items”: {</p>
<p>“description”: “An array of error items containing error codes and
descriptions. Note that the error descriptions will be normalised.”,</p>
<p>“properties”: {</p>
<p>“code”: {</p>
<p>“type”: “integer”,</p>
<p>“format”: “int32”,</p>
<p>“description”: “An error code - should be used in conjunction with
the HTPP response code.”</p>
<p>},</p>
<p>“description”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “A short description of the error.”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“_links”: {</p>
<p>“type”: “array”,</p>
<p>“items”: {</p>
<p>“properties”: {</p>
<p>“rel”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “The relationship to the request e.g. self which
contains the resource that was requested or {object name}, a link to a
resource that is related to the requested resource”</p>
<p>},</p>
<p>“href”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “A link to the related resource. In an error scenario
this is likely to be something such as a link to a support portal.”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>},</p>
<p>“_links”: {</p>
<p>“type”: “array”,</p>
<p>“items”: {</p>
<p>“properties”: {</p>
<p>“rel”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “The relationship to the request e.g. self which
contains the resource that was requested or {object name}, a link to a
resource that is related to the requested resource”</p>
<p>},</p>
<p>“href”: {</p>
<p>“type”: “string”,</p>
<p>“description”: “A link to the related resource”</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p><strong>YAML</strong></p>
<p><strong>OpenAPI 3.0</strong></p>
<p>openapi: 3.0.0</p>
<p>info:</p>
<p>version: 2.0.0</p>
<p>title: Example Agency API</p>
<p>description: A sample API specification demonstrating OpenAPI
capabilities - this is for</p>
<p>example purposes only</p>
<p>termsOfService: https:// api.example.govt.nz/termsandconditions/</p>
<p>contact:</p>
<p>name: Example Agency API team</p>
<p>email: exampleteam@api.govt.nz</p>
<p>url: https://agency.govt.nz</p>
<p>paths:</p>
<p>“/customers/{customerId}”:</p>
<p>get:</p>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>schema:</p>
<p>type: string</p>
<p>tags:</p>
<ul>
<li>get customer details</li>
</ul>
<p>description: |</p>
<p>Returns details for a customer given a unique customer ID</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerRead</p></li>
</ul>
<p>responses:</p>
<p>“200”:</p>
<p>description: OK - Successful</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/customer”</p>
<p>default:</p>
<p>description: Error response</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/errorModel”</p>
<p>put:</p>
<p>tags:</p>
<ul>
<li>modify customer</li>
</ul>
<p>description: Updates a customer’s details</p>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>schema:</p>
<p>type: string</p>
<p>requestBody:</p>
<p>$ref: “#/components/requestBodies/customer”</p>
<p>responses:</p>
<p>“200”:</p>
<p>description: Updated resource successfully</p>
<p>default:</p>
<p>description: Error response</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/errorModel”</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerWrite</p></li>
</ul>
<p>delete:</p>
<p>tags:</p>
<ul>
<li>delete customer</li>
</ul>
<p>description: Deletes an existing customer resource</p>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>schema:</p>
<p>type: string</p>
<p>responses:</p>
<p>“200”:</p>
<p>description: Deleted resource successfully</p>
<p>default:</p>
<p>description: Error response</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/errorModel”</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerDelete</p></li>
</ul>
<p>/customers:</p>
<p>post:</p>
<p>tags:</p>
<ul>
<li>create customer</li>
</ul>
<p>description: Creates a new customer. API will create a customer
resource and, if</p>
<p>successful, return a hyperlink to the created resource</p>
<p>requestBody:</p>
<p>$ref: “#/components/requestBodies/customer”</p>
<p>responses:</p>
<p>“201”:</p>
<p>description: Created resource successfully</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/_links”</p>
<p>default:</p>
<p>description: Error response</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/errorModel”</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerCreate</p></li>
</ul>
<p>servers:</p>
<ul>
<li>url: https:// api.example.govt.nz/v2</li>
</ul>
<p>components:</p>
<p>parameters:</p>
<p>Authorization:</p>
<p>description: For demonstration purposes only - this should not be
required in most</p>
<p>situations as OAuth Authorization Code grant type implicity
indicates</p>
<p>this.</p>
<p>name: Authorization</p>
<p>in: header</p>
<p>required: true</p>
<p>schema:</p>
<p>type: string</p>
<p>default: “Bearer”</p>
<p>requestBodies:</p>
<p>customer:</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/customer”</p>
<p>required: true</p>
<p>securitySchemes:</p>
<p>AuthorizationCode:</p>
<p>type: oauth2</p>
<p>flows:</p>
<p>authorizationCode:</p>
<p>authorizationUrl: https:// api.example.govt.nz/web</p>
<p>tokenUrl: https:// api.example.govt.nz/oauth2/token</p>
<p>scopes:</p>
<p>customerRead: Grants read access to a customer resource</p>
<p>customerWrite: Grants write (update) access to an existing customer
resource</p>
<p>customerCreate: Grants access to create a new customer resource</p>
<p>customerDelete: Grants access to delete an existing customer
resource</p>
<p>schemas:</p>
<p>customer:</p>
<p>type: object</p>
<p>properties:</p>
<p>customerId:</p>
<p>type: string</p>
<p>description: Unique identifier for the customer resource - GUID
format</p>
<p>readOnly: true</p>
<p>names:</p>
<p>type: object</p>
<p>properties:</p>
<p>firstName:</p>
<p>type: string</p>
<p>description: Customers first name</p>
<p>example: Swithin</p>
<p>middleName:</p>
<p>type: string</p>
<p>description: Customers middle name</p>
<p>example: Henry</p>
<p>lastName:</p>
<p>type: string</p>
<p>description: Customers last name</p>
<p>example: Foote</p>
<p>salutation:</p>
<p>type: string</p>
<p>description: Customers salutation - e.g. Mr John Doe</p>
<p>example: Mr Swithin Henry Foote</p>
<p>title:</p>
<p>type: string</p>
<p>description: Customers title - e.g. Ms, Mr, Mrs, Dr etc.</p>
<p>example: Mr</p>
<p>addresses:</p>
<p>type: array</p>
<p>description: An array of addresses. Unpopulated properties or items
will be</p>
<p>returned as null JSON objects.</p>
<p>items:</p>
<p>properties:</p>
<p>addressType:</p>
<p>type: string</p>
<p>description: Address type - e.g. Home, Business</p>
<p>example: Home</p>
<p>address1:</p>
<p>type: string</p>
<p>description: First line of the address e.g. 2 something street</p>
<p>example: 2 Queens Drive</p>
<p>address2:</p>
<p>type: string</p>
<p>description: Second line of address e.g. Khandallah</p>
<p>example: Khandallah</p>
<p>address3:</p>
<p>type: string</p>
<p>description: Third line of address e.g. Wellington</p>
<p>example: Wellington</p>
<p>address4:</p>
<p>type: string</p>
<p>country:</p>
<p>type: string</p>
<p>description: This is a human readable country name e.g. New Zealand
and not</p>
<p>a country code</p>
<p>example: New Zealand</p>
<p>_links:</p>
<p>type: array</p>
<p>readOnly: true</p>
<p>description: An array of related links relevant to the
request/response.</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: A piece of information providing context for the link -
e.g.</p>
<p>self or accounts.</p>
<p>href:</p>
<p>type: string</p>
<p>description: A fully qualified URL to the resource.</p>
<p>errorModel:</p>
<p>type: object</p>
<p>properties:</p>
<p>errors:</p>
<p>type: array</p>
<p>items:</p>
<p>description: An array of error items containing error codes and
descriptions.</p>
<p>Note that the error descriptions will be normalised.</p>
<p>properties:</p>
<p>code:</p>
<p>type: integer</p>
<p>format: int32</p>
<p>description: An error code - should be used in conjunction with the
HTPP</p>
<p>response code.</p>
<p>description:</p>
<p>type: string</p>
<p>description: A short description of the error.</p>
<p>_links:</p>
<p>type: array</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: The relationship to the request e.g. self which contains
the</p>
<p>resource that was requested or {object name}, a link to a</p>
<p>resource that is related to the requested resource</p>
<p>href:</p>
<p>type: string</p>
<p>description: A link to the related resource. In an error scenario
this is</p>
<p>likely to be something such as a link to a support portal.</p>
<p>_links:</p>
<p>type: array</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: The relationship to the request e.g. self which contains
the</p>
<p>resource that was requested or {object name}, a link to a
resource</p>
<p>that is related to the requested resource</p>
<p>href:</p>
<p>type: string</p>
<p>description: A link to the related resource</p>
<p><strong>Swagger 2.0</strong></p>
<p>#Example API Specification for Agency X</p>
<p>#Author Swithin Foote Middleware New Zealand</p>
<p>swagger: ‘2.0’</p>
<p>info:</p>
<p>version: 2.0.0</p>
<p>title: Example Agency API</p>
<p>description: A sample API specification demonstrating OpenAPI
capabilities - this is for example purposes only</p>
<p>termsOfService:
https://developer.example.govt.nz/termsandconditions/</p>
<p>contact:</p>
<p>name: Example Agency API team</p>
<p>email: exampleteam@api.govt.nz</p>
<p>url: https://agency.govt.nz</p>
<p>host: api.example.govt.nz</p>
<p>basePath: /v2</p>
<p>paths:</p>
<p>/customers/{customerId}:</p>
<p>get:</p>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>type: string</p>
<p>tags:</p>
<ul>
<li>get customer details</li>
</ul>
<p>description: |</p>
<p>Returns details for a customer given a unique customer ID</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerRead</p></li>
</ul>
<p>produces:</p>
<ul>
<li>application/json</li>
</ul>
<p>responses:</p>
<p>200:</p>
<p>description: OK - Successful</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/customerDetailsResponse’</p>
<p>default:</p>
<p>description: Error response</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/errorModel’</p>
<p>put:</p>
<p>tags:</p>
<ul>
<li>modify customer</li>
</ul>
<p>description: Updates a customer’s details</p>
<p>consumes:</p>
<ul>
<li>application/json</li>
</ul>
<p>produces:</p>
<ul>
<li>application/json</li>
</ul>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>type: string</p>
<ul>
<li>name: body</li>
</ul>
<p>in: body</p>
<p>required: true</p>
<p>schema:</p>
<p>$ref: “#/definitions/customerRequestModel”</p>
<p>responses:</p>
<p>200:</p>
<p>description: Updated resource successfully</p>
<p>default:</p>
<p>description: Error response</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/errorModel’</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerWrite</p></li>
</ul>
<p>delete:</p>
<p>tags:</p>
<ul>
<li>delete customer</li>
</ul>
<p>description: Deletes an existing customer resource</p>
<p>consumes:</p>
<ul>
<li>application/json</li>
</ul>
<p>produces:</p>
<ul>
<li>application/json</li>
</ul>
<p>parameters:</p>
<ul>
<li>name: customerId</li>
</ul>
<p>in: path</p>
<p>description: Unique ID of customer</p>
<p>required: true</p>
<p>type: string</p>
<p>responses:</p>
<p>200:</p>
<p>description: Deleted resource successfully</p>
<p>default:</p>
<p>description: Error response</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/errorModel’</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerDelete</p></li>
</ul>
<p>/customers:</p>
<p>post:</p>
<p>tags:</p>
<ul>
<li>create customer</li>
</ul>
<p>description: Creates a new customer. API will create a customer
resource and, if successful, return a hyperlink to the created
resource</p>
<p>consumes:</p>
<ul>
<li>application/json</li>
</ul>
<p>produces:</p>
<ul>
<li>application/json</li>
</ul>
<p>parameters:</p>
<ul>
<li>name: body</li>
</ul>
<p>in: body</p>
<p>required: true</p>
<p>schema:</p>
<p>$ref: “#/definitions/customerRequestModel”</p>
<p>responses:</p>
<p>201:</p>
<p>description: Created resource successfully</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/_links’</p>
<p>default:</p>
<p>description: Error response</p>
<p>schema:</p>
<p>$ref: ‘#/definitions/errorModel’</p>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>customerCreate</p></li>
</ul>
<p>securityDefinitions:</p>
<p>AuthorizationCode:</p>
<p>type: oauth2</p>
<p>scopes:</p>
<p>customerRead: Grants read access to a customer resource</p>
<p>customerWrite: Grants write (update) access to an existing customer
resource</p>
<p>customerCreate: Grants access to create a new customer resource</p>
<p>customerDelete: Grants access to delete an existing customer
resource</p>
<p>flow: accessCode</p>
<p>authorizationUrl: https://idm.example.govt.nz/oauth/authorize</p>
<p>tokenUrl: https://idm.example.govt.nz/oauth/access_token</p>
<p>definitions:</p>
<p>customerRequestModel:</p>
<p>type: object</p>
<p>properties:</p>
<p>names:</p>
<p>type: object</p>
<p>properties:</p>
<p>firstName:</p>
<p>type: string</p>
<p>description: Customers first name</p>
<p>middleName:</p>
<p>type: string</p>
<p>description: Customers middle name</p>
<p>lastName:</p>
<p>type: string</p>
<p>description: Customers last name</p>
<p>salutation:</p>
<p>type: string</p>
<p>description: Customers salutation - e.g. Mr John Doe</p>
<p>title:</p>
<p>type: string</p>
<p>description: Customers title - e.g. Ms, Mr, Mrs, Dr etc.</p>
<p>addresses:</p>
<p>type: array</p>
<p>description: An array of addresses. Unpopulated properties or items
will be returned as null JSON objects.</p>
<p>items:</p>
<p>properties:</p>
<p>addressType:</p>
<p>type: string</p>
<p>description: Address type - e.g. Home, Business</p>
<p>address1:</p>
<p>type: string</p>
<p>description: First line of the address e.g. 2 something street</p>
<p>address2:</p>
<p>type: string</p>
<p>description: Second line of address e.g. Khandallah</p>
<p>address3:</p>
<p>type: string</p>
<p>description: Third line of address e.g. Wellington</p>
<p>address4:</p>
<p>type: string</p>
<p>country:</p>
<p>type: string</p>
<p>description: This is a human readable country name e.g. New Zealand
and not a country code</p>
<p>customerDetailsResponse:</p>
<p>type: object</p>
<p>required:</p>
<ul>
<li>customerId</li>
</ul>
<p>properties:</p>
<p>customerId:</p>
<p>type: string</p>
<p>description: Unique identifier for the customer resource - GUID
format</p>
<p>names:</p>
<p>type: object</p>
<p>properties:</p>
<p>firstName:</p>
<p>type: string</p>
<p>description: Customers first name</p>
<p>middleName:</p>
<p>type: string</p>
<p>description: Customers middle name</p>
<p>lastName:</p>
<p>type: string</p>
<p>description: Customers last name</p>
<p>salutation:</p>
<p>type: string</p>
<p>description: Customers salutation - e.g. Mr John Doe</p>
<p>title:</p>
<p>type: string</p>
<p>description: Customers title - e.g. Ms, Mr, Mrs, Dr etc.</p>
<p>addresses:</p>
<p>type: array</p>
<p>description: An array of addresses. Unpopulated properties or items
will be returned as null JSON objects.</p>
<p>items:</p>
<p>properties:</p>
<p>addressType:</p>
<p>type: string</p>
<p>description: Address type - e.g. Home, Business</p>
<p>address1:</p>
<p>type: string</p>
<p>description: First line of the address e.g. 2 something street</p>
<p>address2:</p>
<p>type: string</p>
<p>description: Second line of address e.g. Khandallah</p>
<p>address3:</p>
<p>type: string</p>
<p>description: Third line of address e.g. Wellington</p>
<p>address4:</p>
<p>type: string</p>
<p>country:</p>
<p>type: string</p>
<p>description: This is a human readable country name e.g. New Zealand
and not a country code</p>
<p>_links:</p>
<p>type: array</p>
<p>description: An array of related links relevant to the
request/response.</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: A piece of information providing context for the link -
e.g. self or accounts.</p>
<p>href:</p>
<p>type: string</p>
<p>description: A fully qualified URL to the resource.</p>
<p>errorModel:</p>
<p>type: object</p>
<p>properties:</p>
<p>errors:</p>
<p>type: array</p>
<p>items:</p>
<p>description: An array of error items containing error codes and
descriptions. Note that the error descriptions will be normalised.</p>
<p>properties:</p>
<p>code:</p>
<p>type: integer</p>
<p>format: int32</p>
<p>description: An error code - should be used in conjunction with the
HTPP response code.</p>
<p>description:</p>
<p>type: string</p>
<p>description: A short description of the error.</p>
<p>_links:</p>
<p>type: array</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: The relationship to the request e.g. self which contains
the resource that was requested or {object name}, a link to a resource
that is related to the requested resource</p>
<p>href:</p>
<p>type: string</p>
<p>description: A link to the related resource. In an error scenario
this is likely to be something such as a link to a support portal.</p>
<p>_links:</p>
<p>type: array</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: The relationship to the request e.g. self which contains
the resource that was requested or {object name}, a link to a resource
that is related to the requested resource</p>
<p>href:</p>
<p>type: string</p>
<p>description: A link to the related resource</p>
<ol type="1">
<li><h1
id="appendix-d---synchronousasynchronous-example-specifications">Appendix
D - Synchronous/Asynchronous Example Specifications</h1></li>
</ol>
<p><strong>OpenAPI 3.0</strong></p>
<p>To visualise paste content below into the OpenAPI editor here <a
href="https://editor.swagger.io/">https://editor.swagger.io/</a></p>
<p>openapi: 3.0.0</p>
<p>info:</p>
<p>version: 1.0.0</p>
<p>title: Example Agency Claims API</p>
<p>description: A sample API specification demonstrating OpenAPI
capabilities - this is for</p>
<p>example purposes only</p>
<p>termsOfService: https:// api.example.govt.nz/termsandconditions/</p>
<p>contact:</p>
<p>name: Example Agency API team</p>
<p>email: exampleteam@api.govt.nz</p>
<p>url: https://agency.govt.nz</p>
<p>paths:</p>
<p>“/claims”:</p>
<p>get:</p>
<p>description: Retrieve details of a claim</p>
<p>tags:</p>
<ul>
<li>get claim</li>
</ul>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>read:claims</p></li>
</ul>
<p>responses:</p>
<p>200:</p>
<p>description: OK</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/claims”</p>
<p>post:</p>
<p>description: Create a claim</p>
<p>tags:</p>
<ul>
<li>Create CLaim</li>
</ul>
<p>security:</p>
<ul>
<li><p>AuthorizationCode:</p></li>
<li><p>write:claims</p></li>
</ul>
<p>requestBody:</p>
<p>$ref: “#/components/schemas/createClaim”</p>
<p>responses:</p>
<p>“201”:</p>
<p>description: Created</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/claims”</p>
<p>default:</p>
<p>description: Error response</p>
<p>content:</p>
<p>application/json:</p>
<p>schema:</p>
<p>$ref: “#/components/schemas/errorModel”</p>
<p>components:</p>
<p>securitySchemes:</p>
<p>AuthorizationCode:</p>
<p>type: oauth2</p>
<p>flows:</p>
<p>authorizationCode:</p>
<p>authorizationUrl: https:// api.example.govt.nz/web</p>
<p>tokenUrl: https:// api.example.govt.nz/oauth2/token</p>
<p>scopes:</p>
<p>read:claims: Grants read access to a claim resource</p>
<p>write:claims: Grants write (update) access to an existing claims
resource</p>
<p>schemas:</p>
<p>createClaim:</p>
<p>description: Create Claim Model</p>
<p>type: object</p>
<p>properties:</p>
<p>customerName:</p>
<p>type: string</p>
<p>example: “John Henry Ford”</p>
<p>claimDetail:</p>
<p>type: string</p>
<p>description: Claims details</p>
<p>example: This is a long string describing the claim for
evaluation……</p>
<p>claims:</p>
<p>description: Claim Response Model</p>
<p>type: object</p>
<p>properties:</p>
<p>claimId:</p>
<p>type: string</p>
<p>format: uuid</p>
<p>description: Unique identifier for the claim</p>
<p>description:</p>
<p>type: string</p>
<p>description: A short description of the claim</p>
<p>status:</p>
<p>type: string</p>
<p>enum: [“PROCESSING”,“REJECTED”,“ACCEPTED”]</p>
<p>claimUri:</p>
<p>type: string</p>
<p>description: Resource identifier for the claim</p>
<p>example: “https://api.exampleagency.govt.nz/claims/{claimId}”</p>
<p>errorModel:</p>
<p>type: object</p>
<p>properties:</p>
<p>errors:</p>
<p>type: array</p>
<p>items:</p>
<p>description: An array of error items containing error codes and
descriptions.</p>
<p>Note that the error descriptions will be normalised.</p>
<p>properties:</p>
<p>code:</p>
<p>type: integer</p>
<p>format: int32</p>
<p>description: An error code - should be used in conjunction with the
HTPP</p>
<p>response code.</p>
<p>description:</p>
<p>type: string</p>
<p>description: A short description of the error.</p>
<p>_links:</p>
<p>type: array</p>
<p>items:</p>
<p>properties:</p>
<p>rel:</p>
<p>type: string</p>
<p>description: The relationship to the request e.g. self which contains
the</p>
<p>resource that was requested or {object name}, a link to a</p>
<p>resource that is related to the requested resource</p>
<p>href:</p>
<p>type: string</p>
<p>description: A link to the related resource. In an error scenario
this is</p>
<p>likely to be something such as a link to a support portal.</p>
<p><strong>AsyncAPI 2.0</strong></p>
<p>To visualise paste content below into the AsyncAPI playground here <a
href="https://playground.asyncapi.io/">https://playground.asyncapi.io</a></p>
<p>asyncapi: 2.0.0</p>
<p>info:</p>
<p>title: Claims Notifications</p>
<p>version: 1.0.0</p>
<p>description: This channel provides claim information and status
notifications</p>
<p>servers:</p>
<p>production:</p>
<p>url: broker.exampleagency.govt.nz</p>
<p>protocol: amqps,secure-mqtt,https</p>
<p>description: This is “Example Agencies” broker.</p>
<p>security:</p>
<ul>
<li>oauth2: []</li>
</ul>
<p>channels:</p>
<p>claims/{claimId}:</p>
<p>publish:</p>
<p>message:</p>
<p>$ref: ‘#/components/messages/claim’</p>
<p>parameters:</p>
<p>claimId:</p>
<p>description: Unique identifier for the claim</p>
<p>schema:</p>
<p>type: string</p>
<p>format: uuid</p>
<p>subscribe:</p>
<p>message:</p>
<p>$ref: ‘#/components/messages/claim’</p>
<p>components:</p>
<p>messages:</p>
<p>claim:</p>
<p>payload:</p>
<p>type: object</p>
<p>properties:</p>
<p>claimId:</p>
<p>type: string</p>
<p>format: uuid</p>
<p>description: Unique identifier for the claim</p>
<p>description:</p>
<p>type: string</p>
<p>description: A short description of the claim</p>
<p>status:</p>
<p>type: string</p>
<p>enum: [“PROCESSING”,“REJECTED”,“ACCEPTED”]</p>
<p>claimUri:</p>
<p>type: string</p>
<p>description: Resource identifier for the claim</p>
<p>example: “https://api.exampleagency.govt.nz/claims/{claimId}”</p>
<p>securitySchemes:</p>
<p>user-password:</p>
<p>type: userPassword</p>
<p>oauth2:</p>
<p>type: oauth2</p>
<p>description: OAuth2 identity service for “Example Agency”</p>
<p>flows:</p>
<p>authorizationCode:</p>
<p>authorizationUrl:
https://api.exampleagency.govt.nz/oauth/authorize</p>
<p>tokenUrl: https://api.exampleagency.govt.nz/oauth/token</p>
<p>scopes:</p>
<p>read:claims: Read details of claims</p>
<ol type="1">
<li><h1 id="appendix-e---standards-for-developing-apis">Appendix E -
Standards for Developing APIs</h1></li>
</ol>
<p>Standards for Developing APIs</p>
<p>In addition to the security standards captured in Part-B the table
below captures (current) API and web standards that should be considered
as part of any API Strategy.</p>
<p>Refer to the <a
href="https://www.digital.govt.nz/standards-and-guidance/technology-and-architecture/government-enterprise-architecture/government-digital-standards-catalogue/">Government
digital standards</a> catalogue for recommended standards and their
current state.</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Standard or Standards Organisation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>OpenAPI</td>
<td>The OpenAPI Specification defines a standard, language-agnostic
interface to RESTful APIs which allows both humans and computers to
discover and understand the capabilities of the service without access
to source code, documentation, or through network traffic
inspection.</td>
</tr>
<tr class="even">
<td>AsyncAPI</td>
<td>AsyncAPI is an open source initiative that seeks to improve the
current state of Event-Driven Architectures (EDA). Their long-term goal
is to make working with EDAs as easy as it is to work with REST
APIs.</td>
</tr>
<tr class="odd">
<td>HTTP</td>
<td>HTTP stands for Hyper Text Transfer Protocol. Communication between
client computers and web servers is done by sending HTTP Requests and
receiving HTTP Responses. In practice, most RESTful APIs use HTTP as a
transport layer and rely on the use of HTTP verbs, like POST, GET, PUT
and DELETE.</td>
</tr>
<tr class="even">
<td>OAuth2/OIDC</td>
<td>The OAuth 2.0 Authorization Framework (OAuth2) is an industry
standard framework that enables third parties limited access to
protected resources and is commonly used authorisation approach for
APIs. Open ID Connect (OIDC) is an identity layer on top of OAuth2 that
allows consuming applications to request information about authenticated
sessions and end users.</td>
</tr>
<tr class="odd">
<td>JSON/JSON Schema</td>
<td>JavaScript Object Notation (JSON) is an open standard for a
lightweight format for storing and transporting data. It is a
“self-describing” notation and is easy for both humans and computers to
understand.</td>
</tr>
<tr class="even">
<td>JWT/JWS/JWE/JWK/JWA</td>
<td>These are a set of open standards for securely transmitting
information between systems using JSON. They include the data structure
a web token (JWT), how to sign a JWT (JWS), how to encrypt a JWT (JWE),
and some JSON cryptography practices (JWK and JWA)</td>
</tr>
<tr class="odd">
<td>Fast Healthcare Interoperability Resources (FHIR)</td>
<td>FHIR is a an industry standard for exchanging healthcare information
electronically. It was developed by the HL-7 standards
organisation.</td>
</tr>
<tr class="even">
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Payments New Zealand (PNZ) API Centre Standards</td>
<td>The PNZ API Centre standards is an industry standard for Open
Banking. The security profile is quite interesting in regards to
capturing customer consent for third parties to act on their
behalf.</td>
</tr>
<tr class="even">
<td>SOAP</td>
<td>This standard is Deprecated for NZ Government - GEAG has determined
that the standard should not be used for new work, but may still be in
use for existing APIs.</td>
</tr>
<tr class="odd">
<td>Financial Grade API (FAPI) Security Profile</td>
<td>Another industry standard for the financial sector. It is an example
of good security profile practices.</td>
</tr>
<tr class="even">
<td>Pan European Public Procurement Online (Peppol)</td>
<td>Peppol is a global standardised framework that enables businesses to
exchange procurement documents electronically. To do this, Peppol
provides and maintains artefacts and specifications to make it possible
for businesses using different systems to ‘speak’ to each other.The use
of Peppol is governed by a multi-lateral agreement structure, owned and
maintained by OpenPeppol.</td>
</tr>
<tr class="odd">
<td>Internet Engineering Task Force (IETF)</td>
<td>The IETF is a large open international community concerned with the
evolution of the Internet architecture and the smooth operation of the
Internet. Their mission is to make the Internet work better by producing
high quality, relevant technical documents that influence the way people
design, use, and manage the Internet. Many of the standards listed above
were developed through the IETF.</td>
</tr>
<tr class="even">
<td>Standards New Zealand</td>
<td></td>
</tr>
<tr class="odd">
<td>A business unit within the Ministry of Business, Innovation and
Employment, which specialises in managing the development of standards.
They also publish and sell NZ, joint Australia-NZ, and international
standards.</td>
<td></td>
</tr>
<tr class="even">
<td>Stats NZ: Standards and classifications</td>
<td></td>
</tr>
<tr class="odd">
<td>Information about the standards and classifications Stats NZ use and
maintain, news about reviews, and tools to help classify and code
responses.</td>
<td></td>
</tr>
<tr class="even">
<td>Health Information Standards Organisation (HISO)</td>
<td>This organisation supports and promotes the development and adoption
of fit-for-purpose health information standards for the NZ health
system.</td>
</tr>
<tr class="odd">
<td>Data Content Requirements</td>
<td>There is a documented set of government data content requirements -
<a
href="https://www.data.govt.nz/manage-data/data-content-standardisation/register-of-government-data-content-requirements/">https://www.data.govt.nz/manage-data/data-content-standardisation/register-of-government-data-content-requirements/</a></td>
</tr>
</tbody>
</table>
<p>Table 25: Standards for Developing APIs</p>
<p><a
href="#sdfootnote1anc">1</a>https://tools.ietf.org/html/rfc6648</p>
<p><a href="#sdfootnote2anc">2</a><a
href="https://www.hl7.org/fhir/patient.html">https://www.hl7.org/fhir/patient.html</a></p>
<p><a
href="#sdfootnote3anc">3</a>https://tools.ietf.org/html/rfc7159</p>
<p><a href="#sdfootnote4anc">4</a><em>See</em> <a
href="https://devportal.yaas.io/tools/apibestpractices/index.html#BatchProcessing"><em>https://devportal.yaas.io/tools/apibestpractices/index.html#BatchProcessing</em></a>
<em>for best practice</em></p>
<p><a href="#sdfootnote5anc">5</a><em>See</em> <a
href="https://restlet.com/http-status-codes-map"><em>https://restlet.com/http-status-codes-map</em></a>
<em>for a map of HTTP Status Codes</em></p>
<p><a href="#sdfootnote6anc">6</a> <em>See</em> <a
href="https://www.owasp.org/index.php/Top_10_2007-Information_Leakage_and_Improper_Error_Handling"><em>https://www.owasp.org/index.php/Top_10_2007-Information_Leakage_and_Improper_Error_Handling</em></a></p>
<p><a href="#sdfootnote7anc">7</a>
https://tools.ietf.org/html/rfc7234</p>
<p><a
href="#sdfootnote8anc">8</a>https://tools.ietf.org/html/rfc6648</p>
